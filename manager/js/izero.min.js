function onAbortRequestAction(){null!=requestAction&&requestAction.abort()}function onNavigatorSettingClickListener(){onDialogNavigatorEntry("div.dialog-navigator-setting",function(t){hideAllEntryLayoutDialog(function(){showDialogLayout(),t.animationIn(TIME_ANIMATION_IN)},!0)},!0)}function onNavigatorInfoClickListener(){onDialogNavigatorEntry("div.dialog-navigator-info",function(t){hideAllEntryLayoutDialog(function(){showDialogLayout(),t.animationIn(TIME_ANIMATION_IN)},!0)},!0)}function onNavigatorExitClickListener(){onDialogNavigatorEntry("div.dialog-navigator-exit",function(t){var e=t.find("input[type=submit]");hideAllEntryLayoutDialog(function(){showDialogLayout(),enableSubmit(e),t.animationIn(TIME_ANIMATION_IN)},!0)},!0)}function onNavigatorExitCheckboxClickListener(){alert($(this).val())}function onSubmitNavigatorExitDialog(){return onDialogNavigatorEntry("div.dialog-navigator-exit",function(t){var e=t.find("input[type=radio][name=type]:checked"),i=t.find("input[type=submit]");disableSubmit(i),showProgressBarNavigator(),e=e.length<=0?1:parseInt(e.val()),$.ajax({url:CGI_PATH+CGI_ARRAY.EXIT,data:{type:e,submit:i.val()},beforeSend:function(){showAlertDialogNavigatorExit(ALERT_INFO,'<span class="progress-text">Đang thoát</span>',!0)},error:function(t,e,n){showAlertErrorConnection(showAlertDialogNavigatorExit,e,!0,function(){enableSubmit(i),hideProgressBarNavigator()})},success:function(t,n,a){isValidate(hideDialog,t.code)&&(null!=t.error?showAlertDialogNavigatorExit(ALERT_DANGER,t.error,!0,function(){enableSubmit(i),hideProgressBarNavigator()}):showAlertDialogNavigatorExit(ALERT_SUCCESS,t.success,!0,function(){setTimeout(function(){2==e?hideAllEntryLayoutDialog(function(){hideDialogLayout(),hideProgressBarNavigator(),enableSubmit(i)}):hideAllEntryLayoutDialog(function(){hideDialogLayout(),showLayoutLogin(!1,ALERT_NONE,null,function(){enableSubmit(i),hideProgressBarNavigator()})})},TIME_EXIT_DIALOG)}))}})}),!1}function onSubmitNavigatorFileCreateDialog(){return onDialogNavigatorEntry("div.dialog-navigator-file-create",function(t){var e=t.find("input[name=name]"),i=t.find("input[name=type]:checked"),n=t.find("input[type=submit]");disableSubmit(n),showProgressBarNavigator(),null==e.val()||e.val().length<=0?showAlertDialogNavigatorFileCreate(ALERT_DANGER,"Chưa nhập tên",!0,function(){enableSubmit(n),hideProgressBarNavigator()}):i.length<=0||parseInt(i.val())<1&&parseInt(i.val())>2?showAlertDialogNavigatorFileCreate(ALERT_DANGER,"Chưa chọn tạo thư mục hay tập tin",!0,function(){enableSubmit(n),hideProgressBarNavigator()}):$.ajax({url:CGI_PATH+CGI_ARRAY.CREATE,data:{dir:pathListFile,name:e.val(),type:parseInt(i.val()),submit:n.val()},beforeSend:function(){showAlertDialogNavigatorFileCreate(ALERT_INFO,'<span class="progress-text">Đang tạo</span>',!0)},error:function(t,e,i){showAlertErrorConnection(showAlertDialogNavigatorFileCreate,e,!0,function(){enableSubmit(n),hideProgressBarNavigator()})},success:function(t,i,a){isValidate(hideDialog,t.code)&&(null!=t.error?showAlertDialogNavigatorFileCreate(ALERT_DANGER,t.error,!0,function(){enableSubmit(n),hideProgressBarNavigator()}):showAlertDialogNavigatorFileCreate(ALERT_SUCCESS,t.success,!0,function(){invalidateDataListFile(t.path,t.list,pageListFile,function(){hideProgressBarNavigator(),setInterval(function(){e.val(""),enableSubmit(n)},TIME_EXIT_DIALOG)})}))}})}),!1}function onSubmitEditInfoFileDialog(){return onDialogFile("div.dialog-file-edit-info",function(t,e,i,n){var a=n.find("input[name=name]"),o=n.find("input[name=chmod]"),s=n.find("input[type=submit]");disableSubmit(s),showProgressBarNavigator(),null==a.val()||a.val().length<=0?showAlertDialogFileEditInfo(ALERT_DANGER,"Chưa nhập tên tập tin",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):null==o.val()||o.val().length<=0?showAlertDialogFileEditInfo(ALERT_DANGER,"Chưa nhập phân quyền tập tin",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):0==isChmodNumber(o.val())?showAlertDialogFileEditInfo(ALERT_DANGER,"Phân quyền tập tin sai",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):i.name==a.val()&&i.chmod==o.val()?showAlertDialogFileEditInfo(ALERT_DANGER,"Không có gì thay đổi",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):requestAction=$.ajax({url:CGI_PATH+CGI_ARRAY.FILE_EDIT,data:{dir:pathListFile,name_old:i.name,name_new:a.val(),chmod_old:i.chmod,chmod_new:o.val(),submit:s.val()},beforeSend:function(){showAlertDialogFileEditInfo(ALERT_INFO,'<span class="progress-text">Đang thay đổi thông tin tập tin</span>',!0,null,!0)},error:function(t,e,i){showAlertErrorConnection(showAlertDialogFileEditInfo,e,!0,function(){enableSubmit(s),hideProgressBarNavigator()})},success:function(t,e,i){isValidate(hideDialog,t.code)&&(null!=t.error?showAlertDialogFileEditInfo(ALERT_DANGER,t.error,!0,function(){enableSubmit(s),hideProgressBarNavigator()}):showAlertDialogFileEditInfo(ALERT_SUCCESS,t.success,!0,function(){invalidateDataListFile(t.path,t.list,pageListFile,function(){hideProgressBarNavigator(),setTimeout(function(){onActionInfoFileClickListener(),hideAlertDialogFileEditInfo(),enableSubmit(s)},TIME_EXIT_DIALOG)})}))}})}),!1}function onSubmitCopyFileDialog(){return onDialogFile("div.dialog-file-copy",function(t,e,i,n){var a=n.find("input[name=path_to]"),o=n.find("input[name=is_delete]:checked").length,s=n.find("input[type=submit]");disableSubmit(s),showProgressBarNavigator(),null==a.val()||a.val().length<=0?showAlertDialogFileCopy(ALERT_DANGER,"Chưa nhập đường dẫn sao chép đến",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):validatePath(a.val())==pathListFile?showAlertDialogFileCopy(ALERT_DANGER,"Đường dẫn sao chép mới phải khác đường dẫn hiện tại",!0,function(){enableSubmit(s),hideProgressBarNavigator()}):(console.log(o),requestAction=$.ajax({url:CGI_PATH+CGI_ARRAY.FILE_COPY,data:{dir:pathListFile,name:i.name,path_to:a.val(),is_delete:o,submit:s.val()},beforeSend:function(){showAlertDialogFileCopy(ALERT_INFO,'<span class="progress-text">Đang sao chép tập tin</span>',!0)},error:function(t,e,i){showAlertErrorConnection(showAlertDialogFileCopy,e,!0,function(){enableSubmit(s),hideProgressBarNavigator()})},success:function(t,e,i){function n(){hideProgressBarNavigator(),setTimeout(function(){hideDialogLayout(function(){hideAlertDialogFileCopy(),1===o?hideAllEntryLayoutDialog():onActionInfoFileClickListener(),enableSubmit(s)})},TIME_EXIT_DIALOG)}isValidate(hideDialog,t.code)&&(null!=t.error?showAlertDialogFileCopy(ALERT_DANGER,t.error,!0,function(){enableSubmit(s),hideProgressBarNavigator()}):showAlertDialogFileCopy(ALERT_SUCCESS,t.success,!0,function(){1===o&&isVar(t.list)?invalidateDataListFile(t.path,t.list,pageListFile,function(){n()}):n()}))}}))}),!1}function onSubmitDeleteFileDialog(){return onDialogFile("div.dialog-file-delete",function(t,e,i,n){var a=n.find("input[type=submit]");disableSubmit(a),showProgressBarNavigator(),requestAction=$.ajax({url:CGI_PATH+CGI_ARRAY.FILE_DELETE,data:{dir:pathListFile,name:i.name,submit:a.val()},beforeSend:function(){showAlertDialogFileDelete(ALERT_INFO,'<span class="progress-text">Đang xóa tập tin</span>',!0)},error:function(t,e,i){showAlertErrorConnection(showAlertDialogFileDelete,e,!0,function(){enableSubmit(a),hideProgressBarNavigator()})},success:function(t,e,i){isValidate(hideDialog,t.code)&&(null!=t.error?showAlertDialogFileDelete(ALERT_DANGER,t.error,!0,function(){enableSubmit(a),hideProgressBarNavigator()}):showAlertDialogFileDelete(ALERT_SUCCESS,t.success,!0,function(){invalidateDataListFile(t.path,t.list,pageListFile,function(){hideProgressBarNavigator(),setTimeout(function(){hideDialogLayout(function(){hideAlertDialogFileDelete(),hideAllEntryLayoutDialog(),enableSubmit(a)})},TIME_EXIT_DIALOG)})}))}})}),!1}var Alert=function(t){this.layout=null,this.selector=null,this.type=null,this.icon=null,this.listener=null,this.init=function(t){"string"==typeof t?this.layout=$(t):this.layout=t,this.selector=t,0==this.layout.isSelector("span#response")&&this.layout.html(this.layout.html()+'<span id="response"></span>'),this.layout.length>0&&(this.response=this.layout.find("span#response"))},this.invalidate=function(t,e){this.init(t),this.setType(ALERT_INFO),"boolean"!=typeof e&&(e=this.layout.isSelector("button.close")&&"none"!==this.layout.find("button.close").css("display")),this.setDismiss(e)},this.onDismiss=function(t){t.setVisible(!1),"undefined"!==t.listener&&null!==t.listener&&t.listener()},this.set=function(t,e,i,n){"undefined"==typeof e||"function"==typeof e||"boolean"==typeof e||null===e?this.setType(ALERT_DANGER):this.setType(e),"boolean"==typeof e?n=e:"boolean"==typeof i?n=i:("undefined"==typeof n||null===n)&&(n=!0),this.setResponse(t),this.setVisible(!0,n),"function"==typeof e?e():"function"==typeof i&&i()},this.setResponse=function(t){this.response.html('<span class="fa fa-'+this.icon+'"></span> '+t)},this.setType=function(t){var e="alert-danger",i="alert-warning",n="alert-success",a="alert-info";"undefined"==typeof t||null===t||t==ALERT_DANGER?(this.layout.removeClass(i+" "+n+" "+a).addClass(e),this.icon="warning"):t==ALERT_SUCCESS?(this.layout.removeClass(e+" "+i+" "+a).addClass(n),this.icon="check"):t==ALERT_INFO?(this.layout.removeClass(e+" "+i+" "+n).addClass(a),this.icon="info-circle"):t==ALERT_WARNING&&(this.layout.removeClass(e+" "+a+" "+n).addClass(i),this.icon="warning")},this.setDismiss=function(t){var e=this,i="button.close",n=this.layout.isSelector(i);if(t&&0==n){var a='<button type="button" class="close">';a+="<span>&times;</span>",a+="</button>",this.layout.html(a+this.layout.html())}else if(0==t&&n){var o=this.layout.find(i);o.animationOut(0),o.unbind(EVENT_CLICK)}t&&this.layout.find(i).animationIn(0).bind(EVENT_CLICK,function(){e.onDismiss(e)}),this.init(this.selector)},this.setVisible=function(t,e){"boolean"!=typeof e&&(e=!0),t?(this.layout.animationOut(0),this.layout.animationIn(e?TIME_ANIMATION_IN:0)):"none"!==this.layout.css("display")&&this.layout.animationOut(e?TIME_ANIMATION_OUT:0)},this.setListener=function(t){this.listener=t},this.invalidate(t,!0)},Content={layout:null,block:null,dialog:null,entry:null,request:null,initializing:function(){this.layout=$("div#container-content"),this.block=$("div#background-block"),this.dialog=$("div#dialog"),this.setVisible(!0)},abortRequestDialog:function(t){null!==Content.request&&Content.request.abort(function(){Content.request=null}),("boolean"!=typeof t||t===!1)&&Navigator.setProgress(!1)},createRequestDialog:function(t,e,i,n){if(("boolean"!=typeof e.abortRequest||e.abortRequest)&&Content.abortRequestDialog(),"undefined"!=typeof t&&null!==t){var a=null,o=null,s=null,l=null,r=null,u=null,c=null;a="function"==typeof t?t:t.alert,("undefined"==typeof i||"object"!=typeof i)&&(i=null),"undefined"!=typeof e.element&&(u=e.element),"function"==typeof a&&null!=u&&(u.display=a),"undefined"!=typeof e.handler&&null!==e.handler&&("function"==typeof e.handler.error&&(o=e.handler.error),"function"==typeof e.handler.warning&&(s=e.handler.warning),"function"==typeof e.handler.success&&(l=e.handler.success),"function"==typeof e.handler.upload&&(r=e.handler.upload),("string"==typeof e.handler.beforeSend||"function"==typeof e.handler.beforeSend)&&(c=e.handler.beforeSend)),null!=r&&(e.xhr=function(){var t=null;return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.upload.addEventListener(EVENT_PROGRESS,function(e){var i=0;e.lengthComputable&&(i=e.loaded/e.total,i=parseInt(100*i)),i>=100&&t.upload.removeEventListener(EVENT_PROGRESS),r(u,e,e.loaded,e.total,i)}),t}),"function"!=typeof e.error&&(e.error=function(t,n,s){UError.processConnection(a,t,n,function(){null!=i&&i.setEnable(!0),Navigator.setProgress(!1),null!=o&&o(t,n,s,u)},!0,u,"boolean"==typeof e.errorAbort&&e.errorAbort)}),"function"!=typeof e.success&&(e.success=function(t,e,n){Data.validate(t)&&UError.processSuccess(a,t,function(){null!=i&&i.setEnable(!0),Navigator.setProgress(!1),null!=s&&s(t,e,n,u)},function(){null!=l&&l(t,e,n,u),null!=i&&i.setEnable(!0),Navigator.setProgress(!1)},!0,u)}),"undefined"==typeof e.beforeSend&&null!=c&&(e.beforeSend=function(t,e){var i=null;"string"==typeof c?i=c:"function"==typeof c&&(i=c(t,e,u)),"string"==typeof i&&("function"==typeof a?a(u,i,TEXT_CLASS_INFO):a.set('<span class="progress-text">'+i+"</span>",ALERT_INFO))});var d="Button";return"undefined"!=typeof i&&null!==i&&(d=i.val()),"undefined"==typeof e.data?e.data={dir:ListFile.path,submit:d}:("boolean"!=typeof e.abortData||e.abortData===!1)&&("undefined"==typeof e.data.dir&&(e.data.dir=ListFile.path),"undefined"==typeof e.data.submit&&(e.data.submit=d)),("boolean"!=typeof n||n)&&Navigator.setProgress(!0),"boolean"==typeof e.returnRequest&&e.returnRequest!==!1?$.ajax(e):void(Content.request=$.ajax(e))}},setVisible:function(t,e){View.setVisible(this.layout,t,e)},setDialogVisible:function(t,e){var i=this.dialog.css("display");t&&"none"===i?(this.block.animationIn(TIME_ANIMATION_IN),this.dialog.animationIn(TIME_ANIMATION_IN)):0==t&&"none"!==i&&(this.block.animationOut(TIME_ANIMATION_OUT),this.dialog.animationOut(TIME_ANIMATION_OUT)),"function"==typeof e&&e()},setDialogEntry:function(t){this.hideDialogEntry(t),this.entry=t},hideDialogEntry:function(t){Content.abortRequestDialog(),null!=this.entry&&(null===t||"object"==typeof t&&t.name!==this.entry.name)&&this.entry.setVisible(!1),this.entry=null,"function"==typeof t&&t()},hideAllEntry:function(t){Content.hideDialogEntry(),$(".layout-entry").each(function(){var t=$(this);"none"!==t.css("display")&&t.animationOut(0)}),"function"==typeof t&&t()},hideAllDialog:function(t,e){"function"==typeof t&&(e=t),("boolean"!=typeof t||t)&&this.hideDialogEntry(),$("div#dialog div.entry").each(function(){var t=$(this);"none"!==t.css("display")&&t.animationOut(0)}),"function"==typeof e&&e()}},Data={validate:function(t,e,i){if(0!=(t.code&RESULT_CODE_NOT_PERMISSION))return Content.hideAllEntry(),Content.hideAllDialog(),Content.setVisible(!0),Content.setDialogVisible(!1),Initializing.setVisible(!1),Navigator.setLogin(!1),Navigator.setProgress(!1),Login.setVisible(!1),UError.setError(Lang.receiver("you_do_install_file_manager_on_document_root")),!1;var n=null,a=ALERT_DANGER;return 0!=(t.code&RESULT_CODE_IS_CREATE_CONFIG_ERROR)?n=Lang.receiver("config_is_create_error"):0!=(t.code&RESULT_CODE_IS_CONFIG_INIT)?(n=Lang.receiver("config_is_init",t.username,t.password),a=ALERT_INFO):0!=(t.code&RESULT_CODE_IS_CONFIG_ERROR)?n=Lang.receiver("config_is_error_of_set_default",t.username,t.password):0!=(t.code&RESULT_CODE_IS_CONFIG_UPDATE)?n=Lang.receiver("config_is_update_of_set_default",t.username,t.password):0!=(t.code&RESULT_CODE_IS_LOGIN)||"boolean"==typeof i&&!i||(n=Lang.receiver("you_is_not_login")),null==n?!0:(0==Login.isVisible()&&(Content.hideAllEntry(),Content.hideAllDialog(),Content.setVisible(!1),Content.setDialogVisible(!1),Initializing.setVisible(!1),Login.setVisible(!0)),Login.setAlert(n,a),Navigator.setLogin(!1),Navigator.setProgress(!1),"function"==typeof e&&e(),!1)}},DialogDirectory={dialog:[],prefix:"directory-",prefixTitle:"prefix_title_directory_dialog",listSelector:["detail","edit-detail","copy","delete","zip"],listAction:{icon:["info-circle","pencil-square-o","clone","trash","archive"],label:["action_directory_detail_dialog","action_directory_edit_detail_dialog","action_directory_copy_dialog","action_directory_delete_dialog","action_directory_zip_dialog"]},ENTRY_INFO:0,ENTRY_EDIT_DETAIL:1,ENTRY_COPY:2,ENTRY_DELETE:3,ENTRY_ZIP:4,initializing:function(){for(var t=0;t<this.listSelector.length;++t)this.dialog[t]=new Dialog(this.prefix+this.listSelector[t],Lang.createAttributeValue(this.listAction.label[t],this.prefixTitle),this.listAction,t),this.dialog[t].setId(t),this.dialog[t].setOnVisibleChangeListener(this.onVisibleChangeListener),this.dialog[t].setOnSubmitFormListener(this.onSubmitFormListener),this.dialog[t].setOnListActionListener(this.onListActionListener)},onVisibleChangeListener:function(t,e,i,n,a){if(i){var o=ListFile.getEntryByIndex(t.data);null!=o&&(e==DialogDirectory.ENTRY_INFO?(t.find("span#name").text(o.name),t.find("span#size").text(Func.parserSize(o.size)),t.find("span#chmod").text(o.chmod)):e==DialogDirectory.ENTRY_EDIT_DETAIL?(a.name.val(o.name),a.chmod.val(o.chmod)):e==DialogDirectory.ENTRY_COPY?(a.path_to.val(ListFile.path),a.is_delete.setChecked(!1)):e==DialogDirectory.ENTRY_DELETE?t.find("span#name").text(o.name):e==DialogDirectory.ENTRY_ZIP&&(a.path_save.val(ListFile.path),a.filename.val(o.name+".zip"),a.is_override.setChecked(!0),a.is_delete.setChecked(!1)))}},onSubmitFormListener:function(t,e,i,n){i.setEnable(!1,function(){Navigator.setProgress(!0)});var a=ListFile.getEntryByIndex(t.data),o=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})};return null==a?o():void(t.id==DialogDirectory.ENTRY_EDIT_DETAIL?n.name.isEmptyVal()?t.setAlert(Lang.receiver("not_input_name_directory"),o):n.chmod.isEmptyVal()?t.setAlert(Lang.receiver("not_input_chmod_directory"),o):0==Func.isChmodNumber(n.chmod.val())?t.setAlert(Lang.receiver("chmod_directory_wrong"),o):n.name.val()===a.name&&n.chmod.val()===a.chmod?t.setAlert(Lang.receiver("not_has_change"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.DIRECTORY_EDIT,data:{name_old:a.name,chmod_old:a.chmod,name_new:n.name.val(),chmod_new:n.chmod.val()},handler:{beforeSend:Lang.receiver("process_change_info_directory"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){DialogDirectory.dialog[DialogDirectory.ENTRY_EDIT_DETAIL].setData(ListFile.getEntryIndexByName(n.name.val())),DialogDirectory.onListActionListener(t,DialogDirectory.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i):t.id==DialogDirectory.ENTRY_COPY?n.path_to.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_copy_to"),o):Func.validatePath(n.path_to.val())==ListFile.path?t.setAlert(Lang.receiver("path_new_right_other_path_old"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.DIRECTORY_COPY,data:{name:a.name,path_to:n.path_to.val(),is_delete:n.is_delete.isChecked(!0)},handler:{beforeSend:Lang.receiver("process_copy_directory"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){n.is_delete.isChecked()?t.setVisible(!1):DialogDirectory.onListActionListener(t,DialogDirectory.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i):t.id==DialogDirectory.ENTRY_DELETE?t.createRequest({url:CGI_PATH+CGI_ARRAY.DIRECTORY_DELETE,data:{name:a.name},handler:{beforeSend:Lang.receiver("process_delete_directory"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i):t.id==DialogDirectory.ENTRY_ZIP&&(n.path_save.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_save_file_zip"),o):n.filename.isEmptyVal()?t.setAlert(Lang.receiver("not_input_filename_zip"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.DIRECTORY_ZIP,data:{name:a.name,path_save:n.path_save.val(),filename:n.filename.val(),is_override:n.is_override.isChecked(!0),is_delete:n.is_delete.isChecked(!0)},handler:{beforeSend:Lang.receiver("process_zip_directory"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){n.is_delete.isChecked()?t.setVisible(!1):DialogDirectory.onListActionListener(t,DialogDirectory.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i)))},onListActionListener:function(t,e){DialogDirectory.setVisible(function(e){e.setData(t.data)},e,!0)},setVisible:function(t,e,i,n){"number"==typeof t&&(e=t),DialogDirectory.dialog[e].setVisible(t,i,n)}},DialogFile={dialog:[],prefix:"file-",prefixTitle:"prefix_title_file_dialog",listSelector:["detail","","edit-detail","edit-text","extract","copy","delete"],listAction:{icon:["info-circle","download","pencil-square-o","pencil-square-o","archive","clone","trash"],label:["action_file_detail_dialog","action_file_download_dialog","action_file_edit_detail_dialog","action_file_edit_text_dialog","action_file_extract_dialog","action_file_copy_dialog","action_file_delete_dialog"]},contentEditText:null,pageEditText:0,totalEditText:0,ENTRY_INFO:0,ENTRY_DOWNLOAD:1,ENTRY_EDIT_DETAIL:2,ENTRY_EDIT_TEXT:3,ENTRY_EXTRACT:4,ENTRY_COPY:5,ENTRY_DELETE:6,initializing:function(){for(var t=0;t<this.listSelector.length;++t)""!==this.listSelector[t]&&(this.dialog[t]=new Dialog(this.prefix+this.listSelector[t],Lang.createAttributeValue(this.listAction.label[t],this.prefixTitle),this.listAction,t),this.dialog[t].setId(t),this.dialog[t].setOnVisibleChangeListener(this.onVisibleChangeListener),this.dialog[t].setOnSubmitFormListener(this.onSubmitFormListener),this.dialog[t].setOnListActionListener(this.onListActionListener));this.dialog[DialogFile.ENTRY_INFO].setOnVisibleApplyListener(this.onVisibleApplyListener),this.dialog[DialogFile.ENTRY_EDIT_TEXT].setOnVisibleApplyListener(this.onVisibleApplyListener),this.dialog[DialogFile.ENTRY_INFO].setOnCloseListener(this.onCloseListener)},onVisibleApplyListener:function(t,e,i){if(i){var n=ListFile.getEntryByIndex(t.data);if(null==n)return;if(e==DialogFile.ENTRY_INFO&&"undefined"!=typeof n.resolution){var a=ListFile.path+SERVER.SP+n.name,o=CGI_PATH+CGI_ARRAY.GET_IMAGE+a,s=t.find("img#image");if("undefined"==typeof s.attr("path")||s.attr("path")!==a){var l=t.find("li.image-preview div#image-preview-loading");s.bind(EVENT_LOAD,function(){s.attr("path",a),l.animationOut(TIME_IMAGE_PREVIEW_OUT,function(){s.animationIn(TIME_IMAGE_PREVIEW_IN,function(){Navigator.setProgress(!1)})})}),s.bind(EVENT_ERROR,function(){t.isVisible()&&l.animationOut(TIME_IMAGE_PREVIEW_OUT,function(){liImagePreview.animationOut(TIME_IMAGE_PREVIEW_OUT,function(){t.setAlert("Lỗi tải hình ảnh",function(){Navigator.setProgress(!1)})})})}),setTimeout(function(){Navigator.setProgress(!0,function(){s.attr("path",""),s.attr("src",o)})},DEVELOPMENT?20:1)}}else if(e==DialogFile.ENTRY_EDIT_TEXT){var r=t.find("form"),u=t.find("div#loading"),a=r.attr("path"),c=Func.validatePath(ListFile.path+SERVER.SP+n.name);t.alert.setDismiss(!1),("undefined"==typeof a||null===a||a!==c)&&setTimeout(function(){t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_EDIT_TEXT,data:{name:n.name,receiver:1},handler:{error:function(){u.animationOut(0)},warning:function(){u.animationOut(0)},success:function(t){u.animationOut(0),r.animationIn(0),r.attr("path",c),DialogFile.invalidateEditText(t.content)}}})},DEVELOPMENT?100:10)}}},onVisibleChangeListener:function(t,e,i,n,a){if(i){var o=ListFile.getEntryByIndex(t.data);if(null!=o)if(t.setItemListActionVisible(DialogFile.ENTRY_EDIT_TEXT,Func.isFormatText(o.name)||Func.isFormatUnknown(o.name)),t.setItemListActionVisible(DialogFile.ENTRY_EXTRACT,Func.isFormatArchive(o.name)),e==DialogFile.ENTRY_INFO){t.find("span#name").text(o.name),t.find("span#size").text(Func.parserSize(o.size)),t.find("span#chmod").text(o.chmod),t.find("span#format").text(Func.getFormatFile(o.name));var s=t.find("li.image-preview img#image"),l=t.find("li.image-preview div#image-preview-loading"),r=t.find("li.image-preview"),u=t.find("li#resolution");s.unbind(EVENT_LOAD),s.unbind(EVENT_ERROR),"undefined"!=typeof o.resolution?(t.find("span#resolution").text(o.resolution.width+"x"+o.resolution.height),u.animationIn(0),r.animationIn(0),"undefined"!=typeof s.attr("path")&&s.attr("path")===ListFile.path+SERVER.SP+o.name?l.animationOut(0,function(){s.animationIn(1)}):s.animationOut(0,function(){l.animationIn(0)})):(l.animationOut(0),r.animationOut(0),u.animationOut(0))}else if(e==DialogFile.ENTRY_EDIT_TEXT){DialogFile.changeEditText(),DialogFile.invalidateEditText(DialogFile.contentEditText,DialogFile.pageEditText);var c=n.attr("path"),d=Func.validatePath(ListFile.path+SERVER.SP+o.name),f=t.find("div#loading"),p=t.find("input[name=check]"),g=Func.getFormatFile(o.name);"undefined"==typeof c||null===c||c!==d?(n.animationOut(0),f.animationIn(0)):(n.animationIn(0),f.animationOut(0)),!IS_FUNC_EXEC_ENABLE||null===g||"phtml"!==g.toLowerCase()&&null===g.match(/php[0-5]*/gi)?p.animationOut(1):p.animationIn(1)}else e==DialogFile.ENTRY_EDIT_DETAIL?(a.name.val(o.name),a.chmod.val(o.chmod)):e==DialogFile.ENTRY_EXTRACT?(a.path.val(ListFile.path),a.is_delete.setChecked(!1)):e==DialogFile.ENTRY_COPY?(a.path_to.val(ListFile.path),a.is_delete.setChecked(!1)):e==DialogFile.ENTRY_DELETE&&t.find("span#name").text(o.name)}else e==DialogFile.ENTRY_INFO&&DialogFile.onCloseListener(t)},onSubmitFormListener:function(t,e,i,n){i.setEnable(!1,function(){Navigator.setProgress(!0)});var a=ListFile.getEntryByIndex(t.data),o=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})};if(null==a)return o();if(t.id==DialogFile.ENTRY_EDIT_DETAIL)n.name.isEmptyVal()?t.setAlert(Lang.receiver("not_input_name_file"),o):n.chmod.isEmptyVal()?t.setAlert(Lang.receiver("not_input_chmod_file"),o):0==Func.isChmodNumber(n.chmod.val())?t.setAlert(Lang.receiver("chmod_file_wrong"),o):n.name.val()===a.name&&n.chmod.val()===a.chmod?t.setAlert(Lang.receiver("not_has_change"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_EDIT,data:{name_old:a.name,chmod_old:a.chmod,name_new:n.name.val(),chmod_new:n.chmod.val()},handler:{beforeSend:Lang.receiver("process_change_info_file"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){DialogFile.dialog[DialogFile.ENTRY_EDIT_DETAIL].setData(ListFile.getEntryIndexByName(n.name.val())),DialogFile.onListActionListener(t,DialogFile.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i);else if(t.id==DialogFile.ENTRY_EDIT_TEXT){var s=t.find("input[type=submit]");s.setEnable(!1),DialogFile.changeEditText(),DialogFile.invalidateEditText(DialogFile.contentEditText,DialogFile.pageEditText),t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_EDIT_TEXT,data:{name:a.name,content:DialogFile.contentEditText,is_check:"check"===i.attr("name")?1:0},handler:{beforeSend:Lang.receiver("process_change_content_file"),error:function(){s.setEnable(!0)},warning:function(){s.setEnable(!0)},success:function(e){s.setEnable(!0),t.setAlert(Lang.parse(e.success),ALERT_SUCCESS)}}})}else t.id==DialogFile.ENTRY_EXTRACT?n.path.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_extract"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_EXTRACT,data:{name:a.name,path:n.path.val(),is_delete:n.is_delete.isChecked(!0)},handler:{beforeSend:Lang.receiver("process_extract_file"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){n.is_delete.isChecked()?t.setVisible(!1):DialogFile.onListActionListener(t,DialogFile.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i):t.id==DialogFile.ENTRY_COPY?n.path_to.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_copy_to"),o):Func.validatePath(n.path_to.val())==ListFile.path?t.setAlert(Lang.receiver("path_new_right_other_path_old"),o):t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_COPY,data:{name:a.name,path_to:n.path_to.val(),is_delete:n.is_delete.isChecked(!0)},handler:{beforeSend:Lang.receiver("process_copy_file"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){n.is_delete.isChecked()?t.setVisible(!1):DialogFile.onListActionListener(t,DialogFile.ENTRY_INFO)},TIME_EXIT_DIALOG)})}}},i):t.id==DialogFile.ENTRY_DELETE&&t.createRequest({url:CGI_PATH+CGI_ARRAY.FILE_DELETE,data:{name:a.name},handler:{beforeSend:Lang.receiver("process_delete_file"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i)},onCloseListener:function(t){if(t.id==DialogFile.ENTRY_INFO){var e=t.layout.find("li.image-preview img#image");e.unbind(EVENT_LOAD),e.unbind(EVENT_ERROR),("undefined"==typeof e.attr("path")||e.attr("path").length<=0)&&e.attr("src","")}},onListActionListener:function(t,e){if(e==DialogFile.ENTRY_DOWNLOAD){var i=ListFile.getEntryByIndex(t.data);null!=i&&window.open(CGI_PATH+CGI_ARRAY.FILE_DOWNLOAD+ListFile.path+SERVER.SP+i.name,"_self")}else DialogFile.setVisible(function(e){e.setData(t.data)},e,!0)},bindEditText:function(t){var e=DialogFile.dialog[DialogFile.ENTRY_EDIT_TEXT],i=e.find("form textarea"),n=e.findSelector("ul.pagination li span.click");t?(null!=i&&i.bind(EVENT_INPUT,function(t){i.isEmptyVal()&&DialogFile.pageEditText>1&&(DialogFile.changeEditText(),DialogFile.invalidateEditText(DialogFile.contentEditText,DialogFile.pageEditText))}),null!=n&&n.bind(EVENT_CLICK,function(){var t=parseInt(this.id);t<=DialogFile.totalEditText&&(Navigator.setProgress(!0),setTimeout(function(){DialogFile.changeEditText(),DialogFile.invalidateEditText(DialogFile.contentEditText,t),Navigator.setProgress(!1)},TIME_WAIT_GO_PAGE))})):(null!=i&&i.unbind(EVENT_INPUT),null!=n&&n.unbind(EVENT_CLICK))},changeEditText:function(){var t=DialogFile.dialog[DialogFile.ENTRY_EDIT_TEXT],e=t.find("form textarea"),i=e.val(),n=DialogFile.contentEditText,a=DialogFile.pageEditText;if("string"==typeof n)if(n=n.replace("\r\n","\n"),n=n.replace("\r","\n"),CONFIGS.PAGING_EDIT_TEXT>0&&-1!==n.indexOf("\n")){var o=n.split("\n"),s=o.length;if(s>=CONFIGS.PAGING_EDIT_TEXT){var l="",r=Math.ceil(s/CONFIGS.PAGING_EDIT_TEXT);a>r&&(a=r);var u=a*CONFIGS.PAGING_EDIT_TEXT-CONFIGS.PAGING_EDIT_TEXT,c=u+CONFIGS.PAGING_EDIT_TEXT<=s?u+CONFIGS.PAGING_EDIT_TEXT:s;if(u>0)for(var d=0;u>d;++d)l+=o[d]+"\n";if(0==e.isEmptyVal()&&(l+=i.replace("\r\n","\n").replace("\r","\n")+"\n"),r>a)for(var d=c;s>d;++d)l+=d>c?"\n"+o[d]:o[d];DialogFile.invalidateEditText(l,DialogFile.pageEditText)}else DialogFile.contentEditText=i}else DialogFile.contentEditText=i;else DialogFile.contentEditText=i},invalidateEditText:function(t,e){var i=DialogFile.dialog[DialogFile.ENTRY_EDIT_TEXT],n=i.find("form textarea"),a=0,o=0;if(("number"!=typeof e||0>=e)&&(e=1),DialogFile.pageEditText=e,DialogFile.totalEditText=0,"undefined"!=typeof t&&null!==t&&t.length>0){if(t=t.replace("\r\n","\n"),t=t.replace("\r","\n"),CONFIGS.PAGING_EDIT_TEXT>0&&-1!==t.indexOf("\n")){var s=t.split("\n"),l=s.length,r=0;if(l>=CONFIGS.PAGING_EDIT_TEXT){r=Math.ceil(l/CONFIGS.PAGING_EDIT_TEXT),e>r&&(e=r),DialogFile.contentEditText=t,DialogFile.pageEditText=e,DialogFile.totalEditText=r,t="",a=e*CONFIGS.PAGING_EDIT_TEXT-CONFIGS.PAGING_EDIT_TEXT,o=a+CONFIGS.PAGING_EDIT_TEXT<=l?a+CONFIGS.PAGING_EDIT_TEXT:l;for(var u=a;o>u;++u)t+=u>=o-1?s[u]:s[u]+"\n";return n.val(t),void DialogFile.invalidatePageEditText()}}n.val(t)}else n.val(""),t="";DialogFile.contentEditText=t,DialogFile.invalidatePageEditText()},invalidatePageEditText:function(){var t=DialogFile.dialog[DialogFile.ENTRY_EDIT_TEXT],e=t.find("ul.pagination"),i=e.parent();DialogFile.bindEditText(!1),DialogFile.totalEditText>0?(e.html(Func.parserPage(DialogFile.totalEditText,DialogFile.pageEditText)),i.animationIn(0)):(e.html(""),i.animationOut(0)),DialogFile.bindEditText(!0)},setVisible:function(t,e,i,n){"number"==typeof t&&(e=t),DialogFile.dialog[e].setVisible(t,i,n)}},Dialog=function(t,e,i,n){this.layout=$("div#dialog div."+t),this.id=0,this.name=null,this.data=null,this.alert=null,this.init=function(){if(this.layout.length>0&&(this.name=t),null!==(chmod=this.layout.findSelector("ul#chmod-list"))&&0==chmod.isSelector("li")){var e='<li><span lng="chmod_list_system"></span></li>';e+='<li><span lng="chmod_list_group"></span></li>',e+='<li><span lng="chmod_list_user"</span></li>',e+='<div class="divider"></div>',e+='<li><input type="checkbox" name="chmod-root-read"/> <span lng="chmod_list_read"></span></li>',e+='<li><input type="checkbox" name="chmod-group-read"/> <span lng="chmod_list_read"></span></li>',e+='<li><input type="checkbox" name="chmod-user-read"/> <span lng="chmod_list_read"></span></li>',e+='<li><input type="checkbox" name="chmod-root-write"/> <span lng="chmod_list_write"></span></li>',e+='<li><input type="checkbox" name="chmod-group-write"/> <span lng="chmod_list_write"></span></li>',
e+='<li><input type="checkbox" name="chmod-user-write"/> <span lng="chmod_list_write"></span></li>',e+='<li><input type="checkbox" name="chmod-root-execute"/> <span lng="chmod_list_execute"></span></li>',e+='<li><input type="checkbox" name="chmod-group-execute"/> <span lng="chmod_list_execute"></span></li>',e+='<li><input type="checkbox" name="chmod-user-execute"/> <span lng="chmod_list_execute"></span></li>',chmod.html(e)}if(null!=(list=this.layout.findSelector("ul#input-file-list"))&&0==list.isSelector("li.empty")){var e='<li class="empty">';e+='<span lng="input_file_list_empty"></span>',e+="</li>",list.html(e)}if(null!=(list=this.layout.findSelector("ul#input-link-list"))&&0==list.isSelector("li.empty")){var e='<li class="empty">';e+='<span lng="input_link_list_empty"></span>',e+="</li>",list.html(e)}if(null==this.layout.findSelector("div#close")){var e='<div class="divider"></div>';e+='<div id="close">',e+='<span lng="dialog_close"></span>',e+="</div>",this.bind(!1),this.layout.html(this.layout.html()+e),this.bind(!0)}this.layout.isSelector("div.alert")&&(this.alert=new Alert(this.layout.find("div.alert")))},this.bind=function(e){var i=this,n=this.layout.findSelector("form input[type=submit], form button[type=button]"),a=this.layout.findSelector("div#close"),o=this.layout.findSelector("ul#list-action li");this.bindChmod(e),this.bindFile(e),this.bindLink(e),e?(null!=n&&(n.bind(EVENT_CLICK,function(){var e=$(this);return"string"==typeof(t=e.attr("name"))&&"reset"===t?void("function"==typeof i.onSubmitResetFormListener&&i.onSubmitResetFormListener(i,e.parent(),e,i.listElementForm(i.find("form")))):void(("string"!=typeof(parent=e.parent().attr("parent"))||"ul#input-file-list"!==parent)&&i.onSubmitForm(i,e.parent(),e))}),n.bind(EVENT_ENABLE,function(){var t=$(this),e=i.find("form"),n=t.attr("type"),a=t.attr("name"),o=e.findSelector("input[name=reset]");("string"!=typeof n||"submit"===n||"button"===n)&&("string"!=typeof a||"reset"!==a)&&null!=o&&o.setEnable(t.isEnable())})),null!=a&&a.bind(EVENT_CLICK,function(){i.onClose(i)}),null!=o&&o.bind(EVENT_CLICK,function(){i.onListAction(i,parseInt(this.id))})):(null!=n&&(n.unbind(EVENT_CLICK),n.unbind(EVENT_ENABLE)),null!=a&&a.unbind(EVENT_CLICK),null!=o&&o.unbind(EVENT_CLICK))},this.bindChmod=function(t){var e=this,i=null,n=this.layout.findSelector("ul#chmod-list"),a=this.layout.findSelector("ul#chmod-list li input[type=checkbox]");null!=n&&"undefined"!=typeof n.attr("input")&&(i=this.layout.findSelector("input[name="+n.attr("input")+"]")),t?null!=n&&null!=a&&null!=i&&(i.bind(EVENT_INPUT,function(){e.onChmodInputForm(e,n,$(this))}),a.bind(EVENT_CLICK,function(){e.onChmodListForm(e,n,i,$(this))})):(null!=i&&i.unbind(EVENT_INPUT),null!=a&&a.unbind(EVENT_CLICK))},this.bindFile=function(t){var e=this,i=this.layout.findSelector("ul#input-file-list");if(null!=i){var n=i.findSelector("li.task input[type=file]"),a=i.findSelector("div.button button"),o=i.findSelector("div.button button#state");t?(null!=n&&n.bind(EVENT_CHANGE,function(){var t=$(this),n=t.val(),a=0,o=null;0==t.isEmptyVal()&&(a=n.lastIndexOf("/"),-1==a&&(a=n.lastIndexOf("\\")),-1==a?a=0:a+=1,o=t.parent(),o.find("div.name span").text(n.substring(a)),o.find("button#state").attr("state",STATE_UPLOAD_READY),o.animationIn(TIME_ANIMATION_IN),t.unbind(EVENT_CHANGE),e.onUpdateItemFile(e,i))}),null!=a&&a.bind(EVENT_CLICK,function(){var t=$(this);if("remove"==t.attr("id"))e.removeItemFile(e,t.parent().attr("id"),!1);else if("function"==typeof e.onButtonItemFileListener){var n=t.parent();e.onButtonItemFileListener(e,n.parent().parent(),t,n.attr("id")),e.onUpdateItemFile(e,i)}}),null!=o&&o.bind(EVENT_CHANGE_ATTR,function(){var t=$(this),e=t.parent().parent(),i=t.attr("state"),n=e.find("button#remove span"),a=e.find("div.progress-bar");i!=STATE_UPLOAD_RESTART&&(n.removeClass().addClass("fa fa-trash"),a.removeClass("progress-bar-info progress-bar-danger progress-bar-warning active")),i==STATE_UPLOAD_START?("none"!==t.css("display")&&t.animationOut(TIME_ANIMATION_OUT),n.removeClass().addClass("fa fa-remove"),a.css("width","0").addClass("progress-bar-info active")):i==STATE_UPLOAD_RESTART?"none"===t.css("display")&&t.animationIn(TIME_ANIMATION_IN):i==STATE_UPLOAD_ERROR?a.addClass("progress-bar-danger"):i==STATE_UPLOAD_SUCCESS?a.addClass("progress-bar-success"):i==STATE_UPLOAD_READY&&a.css("width","0")})):(null!=n&&n.unbind(EVENT_CHANGE),null!=a&&a.unbind(EVENT_CLICK),null!=o&&o.unbind(EVENT_CHANGE_ATTR))}},this.bindLink=function(t){var e=this,i=this.layout.findSelector("ul#input-link-list");if(null!=i){var n=i.findSelector("li.task input[type=url]"),a=i.findSelector("div.button button"),o=i.findSelector("div.button button#state");t?(null!=n&&n.bind(EVENT_INPUT,function(){var t=$(this),e=t.parent().find("button#state");t.isEmptyVal()||0==Func.isUrl(t.val())?e.attr("state",STATE_IMPORT_WAIT):e.attr("state",STATE_IMPORT_READY)}),null!=a&&a.bind(EVENT_CLICK,function(){var t=$(this);if("remove"==t.attr("id"))e.removeItemLink(e,t.parent().attr("id"),!1);else if("function"==typeof e.onButtonItemLinkListener){var n=t.parent();e.onButtonItemLinkListener(e,n.parent().parent(),t,n.attr("id")),e.onUpdateItemLink(e,i)}}),null!=o&&o.bind(EVENT_CHANGE_ATTR,function(){var t=$(this),e=t.parent().parent().parent(),i=t.attr("state"),n=e.find("button#remove span"),a=e.find("div.message span");if((i==STATE_IMPORT_WAIT||i==STATE_IMPORT_START)&&("none"!==t.css("display")&&t.animationOut(TIME_ANIMATION_OUT),i==STATE_IMPORT_START&&n.removeClass().addClass("fa fa-remove danger")),i==STATE_IMPORT_WAIT||i==STATE_IMPORT_READY||i==STATE_IMPORT_RESTART){i!=STATE_IMPORT_WAIT&&"none"===t.css("display")&&t.animationIn(TIME_ANIMATION_IN);var o=e.find("div.input input[type=url]"),s=e.find("div.name span");o.isEmptyVal()||i==STATE_IMPORT_WAIT?s.text(Lang.receiver("input_link_list_address")):s.text(Func.basenameUrl(o.val()))}(i==STATE_IMPORT_READY||i==STATE_IMPORT_ERROR||i==STATE_IMPORT_SUCCESS)&&n.removeClass().addClass("fa fa-trash danger"),i==STATE_IMPORT_WAIT?e.find("div.input input[type=url]").isEmptyVal()?a.setTextClass(TEXT_CLASS_DANGER).text(Lang.receiver("input_link_list_message_wait")):a.setTextClass(TEXT_CLASS_DANGER).text(Lang.receiver("input_link_list_message_address_wrong")):i==STATE_IMPORT_READY&&a.setTextClass(TEXT_CLASS_INFO).text(Lang.receiver("input_link_list_message_ready"))})):(null!=n&&n.unbind(EVENT_INPUT),null!=a&&a.unbind(EVENT_CLICK),null!=o&&o.unbind(EVENT_CHANGE_ATTR))}},this.find=function(t,e,i){return this.layout.find(t,e,i)},this.findSelector=function(t,e,i){return this.layout.findSelector(t,e,i)},this.abortRequest=function(t){Content.abortRequestDialog(t)},this.createRequest=function(t,e,i){Content.createRequestDialog(this,t,e,i)},this.listElementForm=function(t){if("undefined"==typeof t||null===t||t.length<=0)return null;var e=new Array;return t.find("input").each(function(){var t=$(this);if("submit"!==t.attr("type")){var i=t.attr("name");if(("undefined"==typeof i||null==i||"undefined"==typeof i.length||i.length<=0)&&(i=t.attr("id")),"string"==typeof i){if(null!==i.match(/^chmod\-[a-z]+\-[a-z]+$/gi))return;if("radio"===t.attr("type")&&0==t.is(":checked"))return;"undefined"==typeof e[i]&&e.length++,e[i]=t}}}),e},this.addItemFile=function(t){var e=this.layout.findSelector("ul#input-file-list");if(null!=e){var i=0,n=0,a="file",o=e.countSelector("li.task"),s=e.findSelector("li.task:last-child");if(null!=s&&0==s.isVisible())s.find("input[type=file]").trigger(EVENT_CLICK);else if(null!=s&&"string"==typeof s.attr("id")&&(i=parseInt(s.attr("id"))+1),0>i&&(i=0),"string"==typeof e.attr("max")&&(n=parseInt(e.attr("max"))),"string"==typeof e.attr("name")&&(a=e.attr("name")),0>=n||n>o){var l='<li id="'+i+'" class="task">';l+='<input type="file" name="'+a+'" id="'+i+'"/>',l+='<div class="name"><span></span></div>',l+='<div class="action">',l+='<div class="percent"><div class="progress">',l+='<div class="progress-bar progress-bar-striped active"><span id="percent"></span></div>',l+="</div></div>",l+='<div class="button" parent="ul#input-file-list" id="'+i+'">',l+='<button type="button" id="state" class="btn btn-info" state="'+STATE_UPLOAD_WAIT+'"><span class="fa fa-upload"></span></button>',l+='<button type="button" id="remove" class="btn btn-danger"><span class="fa fa-trash"></span></button>',l+="</div></div>",l+='<div class="message"><span class="info"></span></div>',l+="</li>",t&&this.bindFile(!1),null!=s?s.after(l):null!=(empty=e.findSelector("li.empty"))?empty.after(l):e.html(l);var r=e.find("li.task[id="+i+"]");r.animationOut(0),r.find("div.message span").text(Lang.receiver("input_file_list_message_ready")),r.find("input[type=file]").trigger(EVENT_CLICK),t&&(this.bindFile(!0),this.invalidateLang())}this.onUpdateItemFile(this,e)}},this.addItemLink=function(t){var e=this.layout.findSelector("ul#input-link-list");if(null!=e){var i=0,n=0,a="link",o=e.countSelector("li.task"),s=e.findSelector("li.task:last-child");if((null==s||0==s.find("div.input input[type=url]").isEmptyVal())&&(null!=s&&"string"==typeof s.attr("id")&&(i=parseInt(s.attr("id"))+1),0>i&&(i=0),"string"==typeof e.attr("max")&&(n=parseInt(e.attr("max"))),"string"==typeof e.attr("name")&&(a=e.attr("name")),0>=n||n>o)){var l='<li id="'+i+'" class="task">';l+='<div class="name"><span></span></div>',l+='<div class="input" id="'+i+'">',l+='<input type="url" name="'+a+'" id="'+i+'" lng="input_link_list_input_address"/>',l+='<div class="button" parent="ul#input-link-list" id="'+i+'">',l+='<button type="button" id="state" state="'+STATE_IMPORT_WAIT+'"><span class="fa fa-download success"></span></button>',l+='<button type="button" id="remove"><span class="fa fa-trash danger"></span></button>',l+="</div></div>",l+='<div class="message"><span class="danger"></span></div>',l+="</li>",t&&this.bindLink(!1),null!=s?s.after(l):null!=(empty=e.findSelector("li.empty"))?empty.after(l):e.html(l);var r=e.find("li.task[id="+i+"]");r.animationIn(TIME_ANIMATION_IN),r.find("button#state").animationOut(0),r.find("div.name span").text(Lang.receiver("input_link_list_address")),r.find("div.message span").text(Lang.receiver("input_link_list_message_wait")),t&&(this.bindLink(!0),this.invalidateLang())}this.onUpdateItemLink(this,e)}},this.removeItemFile=function(t,e,i){if("number"==typeof t&&(e=t,t=this),"boolean"!=typeof i&&(i=!0),null!=(list=this.layout.findSelector("ul#input-file-list"))&&null!=(entry=list.findSelector("li.task[id="+e+"]"))){var n=!0;if(entry.find("button#state").attr("state")===STATE_UPLOAD_WAIT)return;"function"==typeof t.onRemoveItemFileListener&&i===!1&&(n=t.onRemoveItemFileListener(t,entry,entry.attr("id"))),("boolean"!=typeof n||n||i)&&(entry.remove(),t.onUpdateItemFile(t,list))}},this.removeItemLink=function(t,e,i){if("number"==typeof t&&(e=t,t=this),"boolean"!=typeof i&&(i=!0),null!=(list=this.layout.findSelector("ul#input-link-list"))&&null!=(entry=list.findSelector("li.task[id="+e+"]"))){var n=!0;"function"==typeof t.onRemoveItemLinkListener&&i===!1&&(n=t.onRemoveItemLinkListener(t,entry,entry.attr("id"))),("boolean"!=typeof n||n||i)&&(entry.remove(),t.onUpdateItemLink(t,list))}},this.invalidateLang=function(){Lang.process(this.layout)},this.onChmodInputForm=function(t,e,i){var n=i.val();null==n&&(n=""),n.length<1?n+="000":n.length<2?n+="00":n.length<3&&(n+="0");var a=n.length,o=0,s=0,l=0;a>=3&&(o=parseInt(n.charAt(a-3))),a>=2&&(s=parseInt(n.charAt(a-2))),a>=1&&(l=parseInt(n.charAt(a-1))),(0>o||o>7)&&(o=0),(0>s||s>7)&&(s=0),(0>l||l>7)&&(l=0),e.setChecked("input[name=chmod-root-read]",0!=(4&o)),e.setChecked("input[name=chmod-root-write]",0!=(2&o)),e.setChecked("input[name=chmod-root-execute]",0!=(1&o)),e.setChecked("input[name=chmod-group-read]",0!=(4&s)),e.setChecked("input[name=chmod-group-write]",0!=(2&s)),e.setChecked("input[name=chmod-group-execute]",0!=(1&s)),e.setChecked("input[name=chmod-user-read]",0!=(4&l)),e.setChecked("input[name=chmod-user-write]",0!=(2&l)),e.setChecked("input[name=chmod-user-execute]",0!=(1&l))},this.onChmodListForm=function(t,e,i,n){var a=e.isChecked("input[name=chmod-root-read]")?4:0;a+=e.isChecked("input[name=chmod-root-write]")?2:0,a+=e.isChecked("input[name=chmod-root-execute]")?1:0;var o=e.isChecked("input[name=chmod-group-read]")?4:0;o+=e.isChecked("input[name=chmod-group-write]")?2:0,o+=e.isChecked("input[name=chmod-group-execute]")?1:0;var s=e.isChecked("input[name=chmod-user-read]")?4:0;s+=e.isChecked("input[name=chmod-user-write]")?2:0,s+=e.isChecked("input[name=chmod-user-execute]")?1:0,i.val(a.toString()+o.toString()+s.toString())},this.onSubmitForm=function(t,e,i){"function"==typeof t.onSubmitFormListener&&t.onSubmitFormListener(t,e,i,this.listElementForm(t.find("form")))},this.onClose=function(t){if(null!=t.alert&&t.alert.setVisible(!1),"function"==typeof t.onCloseListener||"boolean"==typeof this.onCloseListener){var e=t.onCloseListener(t);("undefined"==typeof e||"function"==typeof e||e)&&(t.setVisible(!1),t.abortRequest())}},this.onListAction=function(t,e){"function"==typeof t.onListActionListener&&t.onListActionListener(t,e)},this.onUpdateItemFile=function(t,e){if("undefined"!=typeof e&&null!==e&&"function"==typeof t.onUpdateItemFileListener){var i=e.countSelector("li.task"),n=e.findSelector("li.task:last-child"),a=e.findSelector("li.empty"),o=e.attr("max");"string"!=typeof o&&(o=0),null!=n&&0==n.isVisible()&&i--,null!=a&&(0>=i?a.animationIn(t.isVisible()?TIME_ANIMATION_IN:0):a.animationOut(t.isVisible()?TIME_ANIMATION_OUT:0)),t.onUpdateItemFileListener(t,i,o>0&&i>=o)}},this.onUpdateItemLink=function(t,e){if("undefined"!=typeof e&&null!==e&&"function"==typeof t.onUpdateItemLinkListener){var i=e.countSelector("li.task"),n=e.findSelector("li.empty"),a=e.attr("max");"string"!=typeof a&&(a=0),null!=n&&(0>=i?n.animationIn(t.isVisible()?TIME_ANIMATION_IN:0):n.animationOut(t.isVisible()?TIME_ANIMATION_OUT:0)),t.onUpdateItemLinkListener(t,i,a>0&&i>=a)}},this.onVisibleApplyListener=function(t,e,i,n,a){},this.onVisibleChangeListener=function(t,e,i,n,a){},this.onSubmitFormListener=function(t,e,i,n){},this.onSubmitResetFormListener=function(t,e,i,n){"function"==typeof t.onVisibleChangeListener&&t.onVisibleChangeListener(t,t.id,!0,t.find("form"),n)},this.onCloseListener=function(t){return!0},this.onListActionListener=function(t,e){},this.onRemoveItemFileListener=function(t,e,i){},this.onRemoveItemLinkListener=function(t,e,i){},this.onUpdateItemFileListener=function(t,e,i){},this.onUpdateItemLinkListener=function(t,e,i){},this.onButtonItemFileListener=function(t,e,i,n){},this.onButtonItemLinkListener=function(t,e,i,n){},this.isVisible=function(){return View.isVisible(this.layout)},this.setId=function(t){this.id=t},this.setTitle=function(t){var e=this.layout.findSelector("div#title h4");if("undefined"==typeof t&&(t="dialog_title"),null==e){var i='<div id="title">';i+='<h4 lng="'+t+'"></h4>',i+="</div>",this.bind(!1),this.layout.html(i+this.layout.html()),this.bind(!0),null!=this.alert&&this.alert.invalidate(this.layout.find("div.alert"))}else e.attr(Lang.attribute,t)},this.setListAction=function(t,e){function i(t){if(1==l.length&&l[0]===t)return!0;if(l.length>1)for(var e=0;e<l.length;++e)if(l[e]===t)return!0;return!1}if("undefined"!=typeof t&&null!==t){var n={},a={};if("undefined"==typeof t.icon||null===t.icon?(n.length=0,a=t):n=t.icon,a="undefined"==typeof t.label||null===t.label?t:t.label,null==this.layout.findSelector("ul#list-action")){var o=this.layout.findSelector("div#close").prev("div.divider");if(null==o)return;var s='<div class="divider"></div>';s+='<ul id="list-action"></ul>',o.before(s)}var l=null,r="",u=Math.max(n.length,a.length);"number"==typeof e?l=[e]:"undefined"!=typeof e&&null!==e&&(l=e),"undefined"==typeof l.length&&(l.length=0);for(var c=0;u>c;++c)0==i(c)&&(r+='<li id="'+c+'">',c<n.length&&(r+='<span class="fa fa-'+n[c]+'"></span>'),c<a.length&&(r+='<span lng="'+a[c]+'"></span>'),r+="</li>");this.bind(!1),this.layout.find("ul#list-action").html(r),this.bind(!0)}},this.setListActionVisible=function(t,e){var i=this.layout.findSelector("ul#list-action"),n=i.findSelector("div.divider");null!=i&&("boolean"!=typeof e&&(e=!1),t?(null!=n&&n.animationIn(e?TIME_ANIMATION_IN:0),i.animationIn(e?TIME_ANIMATION_IN:0)):(null!=n&&n.animationOut(e?TIME_ANIMATION_OUT:0),i.animationOut(e?TIME_ANIMATION_OUT:0)))},this.setItemListActionVisible=function(t,e){var i=this.layout.findSelector("ul#list-action");if(null!=i){var n=i.findSelector("li[id="+t+"]");if(null==n)return;e?n.css("display","inherit"):n.css("display","none")}},this.setVisible=function(t,e,i){"function"==typeof t&&t(this),"boolean"==typeof t&&(e=t),"boolean"!=typeof e&&(e=!0);var n=this,a=this.layout.css("display"),o=this.layout.find("form"),s=this.listElementForm(o);e&&"none"===a?("function"==typeof n.onVisibleChangeListener&&n.onVisibleChangeListener(n,n.id,e,o,s),ListFile.abort(),Content.hideAllDialog(),Content.setDialogEntry(this),$("div#dialog").scrollTop(0),Content.setDialogVisible(!0,function(){null!=n.alert&&n.alert.setVisible(!1,!1),n.layout.find("form input[type=submit]").setEnable(!0),n.layout.animationIn(TIME_ANIMATION_IN,function(){"function"==typeof n.onVisibleApplyListener&&n.onVisibleApplyListener(n,n.id,e,o,s)})})):0==e&&"none"!==a&&("function"==typeof n.onVisibleChangeListener&&n.onVisibleChangeListener(n,n.id,e,o,s),this.layout.animationOut(TIME_ANIMATION_OUT,function(){Content.setDialogVisible(!1,function(){null!=n.alert&&n.alert.setVisible(!1,!1),"function"==typeof n.onVisibleApplyListener&&n.onVisibleApplyListener(n,n.id,e,o,s)})})),"function"==typeof i&&i(this)},this.setData=function(t){this.data=t},this.setAlert=function(t,e,i,n){"undefined"!=typeof this.alert&&null!==this.alert&&this.alert.set(t,e,i,n)},this.setOnVisibleApplyListener=function(t){this.onVisibleApplyListener=t},this.setOnVisibleChangeListener=function(t){this.onVisibleChangeListener=t},this.setOnSubmitFormListener=function(t){this.onSubmitFormListener=t},this.setOnSubmitResetFormListener=function(t){this.onSubmitResetFormListener=t},this.setOnCloseListener=function(t){this.onCloseListener=t},this.setOnListActionListener=function(t){this.onListActionListener=t},this.setOnRemoveItemFileListener=function(t){this.onRemoveItemFileListener=t},this.setOnRemoveItemLinkListener=function(t){this.onRemoveItemLinkListener=t},this.setOnUpdateItemFileListener=function(t){this.onUpdateItemFileListener=t},this.setOnUpdateItemLinkListener=function(t){this.onUpdateItemLinkListener=t},this.setOnButtonItemFileListener=function(t){this.onButtonItemFileListener=t},this.setOnButtonItemLinkListener=function(t){this.onButtonItemLinkListener=t},this.init(),this.setTitle(e),this.setListAction(i,n),this.invalidateLang()},DialogNavigator={dialog:[],prefixOption:"navigator-",prefixFile:"navigator-file-",listSelectorOption:["setting","info","exit"],listSelectorFile:["create","upload","import"],listLabelOption:["action_navigator_option_setting","action_navigator_option_info","action_navigator_option_exit"],listActionFile:{icon:["plus-circle","cloud-upload","cloud-download"],label:["action_navigator_file_create_dialog","action_navigator_file_upload_dialog","action_navigator_file_import_dialog"]},requestUpload:[],requestImport:[],ENTRY_SETTING:0,ENTRY_INFO:1,ENTRY_EXIT:2,ENTRY_FILE_CREATE:3,ENTRY_FILE_UPLOAD:4,ENTRY_FILE_IMPORT:5,initializing:function(){for(var t=DialogNavigator.ENTRY_SETTING;t<=DialogNavigator.ENTRY_EXIT;++t)this.dialog[t]=new Dialog(this.prefixOption+this.listSelectorOption[t],this.listLabelOption[t]),this.dialog[t].setId(t),this.dialog[t].setOnVisibleApplyListener(this.onVisibleApplyListener),this.dialog[t].setOnVisibleChangeListener(this.onVisibleChangeListener),this.dialog[t].setOnSubmitFormListener(this.onSubmitFormListener);for(var t=DialogNavigator.ENTRY_FILE_CREATE;t<=DialogNavigator.ENTRY_FILE_IMPORT;++t){var e=t-DialogNavigator.ENTRY_FILE_CREATE;this.dialog[t]=new Dialog(this.prefixFile+this.listSelectorFile[e],this.listActionFile.label[e],this.listActionFile,e),this.dialog[t].setId(t),this.dialog[t].setOnVisibleApplyListener(this.onVisibleApplyListener),this.dialog[t].setOnVisibleChangeListener(this.onVisibleChangeListener),this.dialog[t].setOnSubmitFormListener(this.onSubmitFormListener),this.dialog[t].setOnListActionListener(this.onListActionListener)}this.dialog[DialogNavigator.ENTRY_FILE_UPLOAD].setOnRemoveItemFileListener(this.onRemoveItemFileListener),this.dialog[DialogNavigator.ENTRY_FILE_UPLOAD].setOnUpdateItemFileListener(this.onUpdateItemFileListener),this.dialog[DialogNavigator.ENTRY_FILE_UPLOAD].setOnButtonItemFileListener(this.onButtonItemFileListener),this.dialog[DialogNavigator.ENTRY_FILE_IMPORT].setOnRemoveItemLinkListener(this.onRemoveItemLinkListener),this.dialog[DialogNavigator.ENTRY_FILE_IMPORT].setOnUpdateItemLinkListener(this.onUpdateItemLinkListener),this.dialog[DialogNavigator.ENTRY_FILE_IMPORT].setOnButtonItemLinkListener(this.onButtonItemLinkListener)},onVisibleApplyListener:function(t,e,i){e==DialogNavigator.ENTRY_FILE_UPLOAD&&0==i?t.find("ul#input-file-list li input[type=file]").each(function(){var e=$(this),i=e.parent(),n=i.find("button#state"),a=n.attr("state"),o=n.attr("time");"string"!=typeof o&&(o=0),(a==STATE_UPLOAD_ERROR||a==STATE_UPLOAD_SUCCESS)&&parseInt(o)<Date.now()-TIME_REMOVE_TASK_AUTO&&t.removeItemFile(t,parseInt(i.attr("id")),!0)}):e==DialogNavigator.ENTRY_FILE_IMPORT&&0==i&&t.find("ul#input-link-list li input[type=url]").each(function(){var e=$(this),i=e.parent(),n=i.find("button#state"),a=n.attr("state"),o=n.attr("time");"string"!=typeof o&&(o=0),(a==STATE_IMPORT_ERROR||a==STATE_IMPORT_SUCCESS)&&parseInt(o)<Date.now()-TIME_REMOVE_TASK_AUTO&&t.removeItemLink(t,parseInt(i.attr("id")),!0)})},onVisibleChangeListener:function(t,e,i,n,a){e==DialogNavigator.ENTRY_SETTING?(a.username.val(""),a.password_old.val(""),a.password_new.val(""),a.paging_list_file.val(CONFIGS.PAGING_LIST_FILE),a.paging_edit_text.val(CONFIGS.PAGING_EDIT_TEXT)):e==DialogNavigator.ENTRY_FILE_CREATE?a.name.val(""):(e==DialogNavigator.ENTRY_FILE_UPLOAD||e==DialogNavigator.ENTRY_FILE_IMPORT)&&Toast.setVisible(!1)},onSubmitFormListener:function(t,e,i,n){var a=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})},o=function(){i.setEnable(!1,function(){Navigator.setProgress(!0)})};if(t.id==DialogNavigator.ENTRY_SETTING)if(o(),0==n.username.isEmptyVal()&&n.username.val().length<5)t.setAlert(Lang.receiver("not_wrong_length_username_navigator_option_setting"),a);else if(0==n.password_old.isEmptyVal()&&n.password_new.isEmptyVal())t.setAlert(Lang.receiver("not_input_password_new_navigator_option_setting"),a);else if(0==n.password_old.isEmptyVal()&&0==n.password_new.isEmptyVal()&&n.password_old.val()==n.password_new.val())t.setAlert(Lang.receiver("not_wrong_password_old_navigator_option_setting"),a);else if(0==n.password_new.isEmptyVal()&&n.password_new.val().length<5)t.setAlert(Lang.receiver("not_wrong_length_password_navigator_option_setting"),a);else{var s=parseInt(n.paging_list_file.val()),l=parseInt(n.paging_edit_text.val());isNaN(s)&&(s=0),isNaN(l)&&(l=0),t.createRequest({url:CGI_PATH+CGI_ARRAY.SETTING,data:{username:n.username.val(),password_old:n.password_old.val(),password_new:n.password_new.val(),paging_list_file:s,paging_edit_text:l},handler:{beforeSend:Lang.receiver("process_navigator_option_setting"),success:function(e){CONFIGS.PAGING_LIST_FILE=s,CONFIGS.PAGING_EDIT_TEXT=l,t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(ListFile.path,ListFile.array,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i)}else if(t.id==DialogNavigator.ENTRY_EXIT){o();var r=n.application.isChecked(),u=n.device.isChecked();0==r&&0==u?t.setAlert(Lang.receiver("not_select_navigator_option_exit"),a):t.createRequest({url:CGI_PATH+CGI_ARRAY.EXIT,data:{application:n.application.isChecked(!0),device:n.device.isChecked(!0)},handler:{beforeSend:Lang.receiver("process_navigator_option_exit"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),setTimeout(function(){r?(Content.hideAllEntry(),Content.hideAllDialog(),Content.setVisible(!1),Content.setDialogVisible(!1),Initializing.setVisible(!1),Login.setVisible(!0),Navigator.setLogin(!1),Navigator.setProgress(!1)):t.setVisible(!1)},TIME_EXIT_DIALOG)}}},i)}else if(t.id==DialogNavigator.ENTRY_FILE_CREATE)o(),n.name.isEmptyVal()?t.setAlert(Lang.receiver("not_input_name_navigator_file_create"),a):t.createRequest({url:CGI_PATH+CGI_ARRAY.CREATE,data:{name:n.name.val(),type:n.type.val()},handler:{beforeSend:Lang.receiver("process_navigator_file_create"),success:function(e){n.name.val(""),t.setAlert(Lang.parse(e.success),ALERT_SUCCESS,function(){ListFile.invalidate(e.path,e.list,ListFile.page)})}}},i);else if(t.id==DialogNavigator.ENTRY_FILE_UPLOAD){var c=i.attr("name");if("string"!=typeof c)return;if(t.alert.setVisible(!1),"add"==c)t.addItemFile(!0);else if("start"==c){var d=[];i.setEnable(!1,function(){Navigator.setProgress(!0)}),t.find("ul#input-file-list input[type=file]").each(function(){var t=$(this),e=t.parent().find("button#state").attr("state");0!=t.isEmptyVal()||e!=STATE_UPLOAD_READY&&e!=STATE_UPLOAD_RESTART||d.push(t)});var a=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})};if(d.length<=0)t.setAlert(Lang.receiver("not_files_select_navigator_file_upload"),a);else{a();for(var f=0;f<d.length;++f)DialogNavigator.startUploadItem(t,d[f],n.is_override.isChecked(!0))}}else("remove"==c||"cancel"==c)&&e.find("ul#input-file-list li.task button#state").each(function(){var e=$(this),i=parseInt(e.parent().attr("id")),n=e.attr("state");n!=STATE_UPLOAD_START&&"remove"==c?t.removeItemFile(t,i,!0):n==STATE_UPLOAD_START&&"cancel"==c&&"undefined"!=typeof DialogNavigator.requestUpload[i]&&null!==(request=DialogNavigator.requestUpload[i])&&request.abort()})}else if(t.id==DialogNavigator.ENTRY_FILE_IMPORT){var c=i.attr("name");if("string"!=typeof c)return;if(t.alert.setVisible(!1),"add"==c)t.addItemLink(!0);else if("start"==c){var d=[];i.setEnable(!1,function(){Navigator.setProgress(!0)}),t.find("ul#input-link-list input[type=url]").each(function(){var t=$(this),e=t.parent().parent().find("button#state").attr("state");0!=t.isEmptyVal()||e!==STATE_IMPORT_READY&&e!==STATE_IMPORT_RESTART||d.push(t)});var a=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})};if(d.length<=0)t.setAlert(Lang.receiver("not_links_input_navigator_file_import"),a);else{a();for(var f=0;f<d.length;++f)DialogNavigator.startImportItem(t,d[f],n.is_override.isChecked(!0))}}else("remove"==c||"cancel"==c)&&e.find("ul#input-link-list li.task button#state").each(function(){var e=$(this),i=parseInt(e.parent().attr("id")),n=e.attr("state");n!=STATE_IMPORT_START&&"remove"==c?t.removeItemLink(t,i,!0):n==STATE_IMPORT_START&&"cancel"==c&&"undefined"!=typeof DialogNavigator.requestImport[i]&&null!==(request=DialogNavigator.requestImport[i])&&request.abort()})}},onRemoveItemFileListener:function(t,e,i){if(t.id==DialogNavigator.ENTRY_FILE_UPLOAD){if(t.alert.setVisible(!1),"undefined"==typeof DialogNavigator.requestUpload[i]||null===DialogNavigator.requestUpload[i])return!0;if(DialogNavigator.requestUpload[i].abort(),DialogNavigator.requestUpload[i]=null,"undefined"!==(state=e.find("button#state").attr("state"))&&state!=STATE_UPLOAD_START&&state!=STATE_UPLOAD_WAIT)return!0}return!1},onRemoveItemLinkListener:function(t,e,i){if(t.id==DialogNavigator.ENTRY_FILE_IMPORT){if(t.alert.setVisible(!1),"undefined"==typeof DialogNavigator.requestImport[i]||null===DialogNavigator.requestImport[i])return!0;if(DialogNavigator.requestImport[i].abort(),DialogNavigator.requestImport[i]=null,"undefined"!==(state=entry.find("button#state").attr("state"))&&state!=STATE_IMPORT_START&&state)return!0}return!1},onUpdateItemFileListener:function(t,e,i){t.id==DialogNavigator.ENTRY_FILE_UPLOAD&&(t.alert.setVisible(!1),t.find("button[type=button][name=add]").setEnable(0==i))},onUpdateItemLinkListener:function(t,e,i){t.id==DialogNavigator.ENTRY_FILE_IMPORT&&(t.alert.setVisible(!1),t.find("button[type=button][name=add]").setEnable(0==i))},onButtonItemFileListener:function(t,e,i,n){t.id==DialogNavigator.ENTRY_FILE_UPLOAD&&(t.alert.setVisible(!1),"state"!==i.attr("id")||(state=i.attr("state"))!==STATE_UPLOAD_READY&&state!==STATE_UPLOAD_RESTART||DialogNavigator.startUploadItem(t,e.find("input[type=file]")))},onButtonItemLinkListener:function(t,e,i,n){t.id==DialogNavigator.ENTRY_FILE_IMPORT&&(t.alert.setVisible(!1),"state"!==i.attr("id")||(state=i.attr("state"))!==STATE_IMPORT_READY&&state!==STATE_IMPORT_RESTART||DialogNavigator.startImportItem(t,e.find("input[type=url]")))},onListActionListener:function(t,e){t.id>=DialogNavigator.ENTRY_FILE_CREATE&&t.id<=DialogNavigator.ENTRY_FILE_IMPORT&&DialogNavigator.setVisible(e+DialogNavigator.ENTRY_FILE_CREATE)},setVisible:function(t,e,i,n){"number"==typeof t&&(e=t),DialogNavigator.dialog[e].setVisible(t,i,n)},startUploadItem:function(t,e,i){var n=e.parent(),a=n.find("div.message span"),o=n.find("button#state"),s=n.find("div.progress-bar"),l=s.find("span#percent"),r=e.get(0).files[0],u=parseInt(e.attr("id")),c=new FormData;"undefined"!=typeof DialogNavigator.requestUpload[u]&&null!==DialogNavigator.requestUpload[u]&&(DialogNavigator.requestUpload[u].abort(),DialogNavigator.requestUpload[u]=null),c.append("dir",ListFile.path),c.append("is_override",i),c.append("submit",!0),c.append("file",r),DialogNavigator.requestUpload[u]=Content.createRequestDialog(function(t,e,i,n){"function"==typeof i&&(n=i,i=TEXT_CLASS_DANGER),t.msg.setTextClass(i).html(e),"function"==typeof n&&n()},{url:CGI_PATH+CGI_ARRAY.UPLOAD,element:{id:u,input:e,parent:n,msg:a,state:o,progress:s,percent:l},data:c,async:!0,cache:!1,contentType:!1,processData:!1,enctype:"multipart/form-data",errorAbort:!0,abortData:!0,abortRequest:!1,returnRequest:!0,handler:{beforeSend:function(t,e,i){return i.state.attr("state")!=STATE_UPLOAD_START&&i.state.attr("state",STATE_UPLOAD_START),DialogNavigator.toastItemUpload(),Lang.receiver("navigator_file_upload_message_start")},upload:function(t,e,i,n,a){t.progress.css("width",a+"%"),t.percent.text(a+"%"),t.display(t,Lang.receiver("navigator_file_upload_message_upload")+Func.parserSize(i)+"/"+Func.parserSize(n),TEXT_CLASS_INFO),100==a&&(t.progress.css("width","100%"),t.state.attr("state",STATE_UPLOAD_SUCCESS))},error:function(t,e,i,n){setTimeout(function(){n.state.attr("state",STATE_UPLOAD_ERROR).attr("state",STATE_UPLOAD_RESTART),DialogNavigator.toastItemUpload()},TIME_ERROR_CONNECTION)},warning:function(t,e,i,n){n.state.attr("state",STATE_UPLOAD_ERROR).attr("state",STATE_UPLOAD_RESTART),DialogNavigator.toastItemUpload()},success:function(t,e,i,n){n.state.attr("state",STATE_UPLOAD_SUCCESS),n.state.attr("time",Date.now()),n.display(n,Lang.parse(t.success),TEXT_CLASS_SUCCESS),DialogNavigator.toastItemUpload(),"undefined"!=typeof t.path&&Func.validatePath(t.path)===Func.validatePath(ListFile.path)&&ListFile.invalidate(t.path,t.list,ListFile.page)}}})},startImportItem:function(t,e,i){var n=e.parent().parent(),a=n.find("div.name span"),o=n.find("div.message span"),s=n.find("button#state"),l=parseInt(e.attr("id"));"undefined"!=typeof DialogNavigator.requestImport[l]&&null!==DialogNavigator.requestImport[l]&&(DialogNavigator.requestImport[l].abort(),DialogNavigator.requestImport[l]=null),DialogNavigator.requestImport[l]=Content.createRequestDialog(function(t,e,i,n){"function"==typeof i&&(n=i,i=TEXT_CLASS_DANGER),t.msg.setTextClass(i).html(e),"function"==typeof n&&n()},{url:CGI_PATH+CGI_ARRAY.IMPORT,element:{id:l,input:e,parent:n,msg:o,state:s},async:!0,cache:!1,errorAbort:!0,abortRequest:!1,returnRequest:!0,data:{url:e.val(),name:a.text(),is_override:i},handler:{beforeSend:function(t,e,i){return i.state.attr("state")!=STATE_IMPORT_START&&i.state.attr("state",STATE_IMPORT_START),DialogNavigator.toastItemImport(),Lang.receiver("navigator_file_import_message_start")},error:function(t,e,i,n){setTimeout(function(){n.state.attr("state",STATE_IMPORT_ERROR).attr("state",STATE_IMPORT_RESTART),DialogNavigator.toastItemImport();
},TIME_ERROR_CONNECTION)},warning:function(t,e,i,n){n.state.attr("state",STATE_IMPORT_ERROR).attr("state",STATE_IMPORT_RESTART),DialogNavigator.toastItemImport()},success:function(t,e,i,n){n.state.attr("state",STATE_IMPORT_SUCCESS),n.state.attr("time",Date.now()),n.display(n,Lang.parse(t.success,function(e){return e.replace("{$1}",'<span class="danger">'+Func.parserSize(parseInt(t.size))+"</span>")}),TEXT_CLASS_SUCCESS),DialogNavigator.toastItemImport(),"undefined"!=typeof t.path&&Func.validatePath(t.path)===Func.validatePath(ListFile.path)&&ListFile.invalidate(t.path,t.list,ListFile.page)}}})},toastItemUpload:function(){var t=DialogNavigator.dialog[DialogNavigator.ENTRY_FILE_UPLOAD],e=0,i=0,n=0;if(!t.isVisible()){t.find("ul#input-file-list li button#state").each(function(){var t=$(this).attr("state");t==STATE_UPLOAD_ERROR||t==STATE_UPLOAD_RESTART?e++:t==STATE_UPLOAD_SUCCESS?i++:t==STATE_UPLOAD_READY&&n++});var a="<span>"+Lang.receiver("action_navigator_file_upload_toast")+"</span> ";a+='<span class="danger">'+e+"</span>/",a+='<span class="success">'+i+"</span>/",a+='<span class="info">'+n+"</span>",Toast.set(a)}},toastItemImport:function(){var t=DialogNavigator.dialog[DialogNavigator.ENTRY_FILE_IMPORT],e=0,i=0,n=0;if(!t.isVisible()){t.find("ul#input-link-list li button#state").each(function(){var t=$(this).attr("state");t==STATE_IMPORT_ERROR||t==STATE_IMPORT_RESTART?e++:t==STATE_IMPORT_SUCCESS?i++:t==STATE_IMPORT_READY&&n++});var a="<span>"+Lang.receiver("action_navigator_file_import_toast")+"</span> ";a+='<span class="danger">'+e+"</span>/",a+='<span class="success">'+i+"</span>/",a+='<span class="info">'+n+"</span>",Toast.set(a)}}},Func={basenameUrl:function(t){if("string"!=typeof t)return t;var e=t=Func.validatePath(t),i=t.length,n=i;if(-1===t.indexOf(SERVER.SP))return e;for(;-1!==n&&(n=t.lastIndexOf(SERVER.SP,n),-1!==n);){if(i-1>n){e=t.substring(n+1);break}n--}return(-1===n||e.length<=0)&&(e=t.replace(SERVER.SP,"")),e},getParentPath:function(t){if(null==t)return null;if(t=this.validatePath(t),t==SERVER.SP)return t;var e=t.lastIndexOf(SERVER.SP);return 0===e?SERVER.SP:t.substring(0,e)},getFormatFile:function(t){var e=Lang.receiver("unknown");if(null==t||t.length<=0)return e;var i=t.lastIndexOf(".");return-1!=i&&(e=t.substring(i+1).toLowerCase()),e},isChmodNumber:function(t){t+="";var e=t.length,i=0,n=0,a=0;return e>=3&&(i=parseInt(t.charAt(e-3))),e>=2&&(n=parseInt(t.charAt(e-2))),e>=1&&(a=parseInt(t.charAt(e-1))),0>i||i>7?!1:0>n||n>7?!1:0>a||a>7?!1:!0},isUrl:function(t){return"string"!=typeof t?!1:((-1===(index=t.toLowerCase().indexOf("http://"))||0!==index)&&(t="http://"+t),null!==t.match(/^(http|https|ftp):\/\/([A-Z0-9][A-Z0-9_-]*(?:\.[A-Z0-9][A-Z0-9_-]*)+):?(\d+)?\/?/gi))},isFormat:function(t,e,i){var n=t;("boolean"!=typeof i||i)&&(n=Func.getFormatFile(t));for(var a=0;a<e.length;++a)if(n==e[a])return!0;return!1},isFormatUnknown:function(t){return 0==Func.isFormatPicture(t)&&0==Func.isFormatText(t)&&0==Func.isFormatArchive(t)&&0==Func.isFormatAudio(t)&&0==Func.isFormatVideo(t)?!0:!1},isFormatPicture:function(t){return Func.isFormat(t,FORMATS.PICTURE)},isFormatText:function(t){return Func.isFormat(t,FORMATS.TEXT)||Func.isFormat(t,FORMATS.OTHER)?!0:Func.isFormat(t.substring(0,-1==t.indexOf(".")?t.length:t.indexOf(".")).toLowerCase(),FORMATS.SOURCE,!1)},isFormatArchive:function(t){return Func.isFormat(t,FORMATS.ARCHIVE)},isFormatAudio:function(t){return Func.isFormat(t,FORMATS.AUDIO)},isFormatVideo:function(t){return Func.isFormat(t,FORMATS.VIDEO)},parserPage:function(t,e){var i="",n=PAGING_NUMBER-2;if(n%2==0&&n++,0>=e&&(e=1),t<=PAGING_NUMBER)for(var a=1;t>=a;++a)i+=e==a?'<li class="active"><span>'+a+"</span></li>":'<li><span id="'+a+'" class="click">'+a+"</span></li>";else{i+=1==e?'<li class="active"><span>1</span></li>':'<li><span id="1" class="click">1</span></li>',e>n&&(i+='<li><span id="'+(1>e-n?1:e-n)+'" class="click">...</span></li>');var o=0,s=0;o=n>=e?2:e-(e>t-n?e-(t-n):Math.floor(n>>1)),s=e>=t-n+1?t-1:e+(n>=e?n+1-e:Math.floor(n>>1));for(var a=o;s>=a;++a)i+=a==e?'<li class="active"><span>'+a+"</span></li>":'<li><span id="'+a+'" class="click">'+a+"</span></li>";t-n+1>e&&(i+='<li><span id="'+(e+n>t?t:e+n)+'" class="click">...</span></li>'),i+=e==t?'<li class="active"><span>'+t+"</span></li>":'<li><span id="'+t+'" class="click">'+t+"</span></li>"}return i},parserSize:function(t){return 1024>t?t+"B":1048576>t?Math.round(t/1024,2)+"KB":1073741824>t?Math.round(t/1048576,2)+"MB":Math.round(t/1073741824,2)+"GB"},validatePath:function(t){return t=t.replace(/\\{1,}/g,SERVER.SP),t=t.replace(SERVER.SP+"."+SERVER.SP,SERVER.SP+SERVER.SP),t=t.replace(SERVER.SP+".."+SERVER.SP,SERVER.SP+SERVER.SP),t=t.replace(new RegExp(SERVER.SP+"\\.{1,2}$","g"),SERVER.SP+SERVER.SP),t=t.replace(new RegExp(SERVER.SP+"{2,}","g"),SERVER.SP),t=t.replace(new RegExp("(.+?)"+SERVER.SP+"$","g"),"$1")}},Initializing={layout:null,initializing:function(){this.layout=$("div#layout-initializing"),this.invalidateLang(),this.onLoad()},invalidateLang:function(){Lang.process(Initializing.layout)},onLoad:function(){Login.setVisible(!1),UError.setVisible(!1),Content.setVisible(!0,function(){Initializing.setVisible(!0),Navigator.setLogin(!1),Navigator.setProgress(!0),$.ajax({url:CGI_PATH+CGI_ARRAY.LIST_FILE,data:{submit:!0},error:function(t,e,i){UError.processConnection(null,t,e,function(){Navigator.setProgress(!1)})},success:function(t,e,i){Data.validate(t)&&(Navigator.setLogin(!0),ListFile.receiver(function(t){t==STATUS_SUCCESS&&(Initializing.setVisible(!1),ListFile.setVisible(!0),Navigator.setProgress(!1))}))}})})},setVisible:function(t,e){View.setVisible(this.layout,t,e)}},Lang={attribute:"lng",flag:function(){return"undefined"!=typeof LANGS&&null!==LANGS?LANGS.flag:null},count:function(){return"undefined"!=typeof LANGS&&null!==LANGS?LANGS.count:void 0},receiver:function(t){var e=t;if("undefined"!=typeof LANGS&&null!==LANGS&&"undefined"!=typeof LANGS.array[t]&&(e=LANGS.array[t],arguments.length>1))for(var i=1;i<arguments.length;++i)e=e.replace("{$"+i+"}",arguments[i]);return e},parse:function(t,e){return Lang.parseAttributeValue(t,e)},process:function(t){"string"==typeof t&&(t=$(t));var e=t.findSelector("h4"),i=t.findSelector("span"),n=t.findSelector("input");null!=e&&e.each(function(){Lang.html(this)}),null!=i&&i.each(function(){Lang.html(this)}),null!=n&&n.each(function(){var t=$(this),e=t.attr(Lang.attribute);if("undefined"!=typeof e){var i=t.attr("type");e=Lang.isAttributeValue(e)?Lang.parseAttributeValue(e):Lang.receiver(e),"undefined"==typeof i&&(i="text"),"submit"==i||"radio"==i||"checkbox"==i?t.attr("value",e):"undefined"!=typeof t.attr("set")?t.attr("value",e):t.attr("placeholder",e)}})},html:function(t){var e=$(t),i=e.attr(Lang.attribute);"undefined"!=typeof i&&(Lang.isAttributeValue(i)?e.html(Lang.parseAttributeValue(i)):e.html(Lang.receiver(i)))},isAttributeValue:function(t){return null!=t&&t.length&&t.length>0?null!==t.match(/^\{.+?\}$/g):!1},createAttributeValue:function(){var t="";if(arguments.length>0){t="{";for(var e=0;e<arguments.length;++e)t+=arguments[e],e+1<arguments.length&&(t+=",");t+="}"}return t},parseAttributeValue:function(t,e){var i="",n=null;if(Lang.isAttributeValue(t)){t=t.substring(1,t.length-1),t=t.split(",");for(var a=0;a<t.length;++a){if(n=Lang.receiver(t[a].trim()),"function"==typeof e){var o=e(n,a);"undefined"!=typeof o&&(n=o)}i+=n}}else i=t;return i}};!function(t){var e=t.fn.val,i=t.fn.attr,n=t.fn.prop,a=t.fn.removeAttr,o=t.fn.removeProp,s=t.fn.css;t.fn.val=function(t){return arguments.length>0?e.call(this,t).trigger(EVENT_CHANGE).trigger(EVENT_INPUT):e.call(this)},t.fn.attr=function(t,e){if(1==arguments.length){var n=i.call(this,t);return"string"!=typeof t&&n.trigger(EVENT_CHANGE_ATTR,[t]),n}return 2==arguments.length?i.call(this,t,e).trigger(EVENT_CHANGE_ATTR,[t,e]):i.call(this)},t.fn.removeAttr=function(t){return 1==arguments.length?a.call(this,t):a.call(this)},t.fn.prop=function(t,e){if(1==arguments.length){var i=n.call(this,t);return"string"!=typeof t&&i.trigger(EVENT_CHANGE_ATTR,[t]),i}return 2==arguments.length?n.call(this,t,e).trigger(EVENT_CHANGE_ATTR,[t,e]):n.call(this)},t.fn.removeProp=function(t){return 1==arguments.length?o.call(this,t):o.call(this)},t.fn.css=function(t,e){if(1==arguments.length){var i=s.call(this,t);return"string"!=typeof t&&i.trigger(EVENT_CHANGE_CSS,[t]),i}return 2==arguments.length?s.call(this,t,e).trigger(EVENT_CHANGE_CSS,[t,e]):s.call(this)},t.fn.animationIn=function(t,e){if(0>=t){var i=this.css({display:"block"});return"function"==typeof e&&e(),i}return this.fadeIn(t,e)},t.fn.animationOut=function(t,e){if(0>=t){var i=this.css({display:"none"});return"function"==typeof e&&e(),i}return this.fadeOut(t,e)},t.fn.setEnable=function(t,e){return t?this.removeProp("disabled"):this.prop("disabled","disabled"),this.trigger(EVENT_ENABLE,[t]),"function"==typeof e&&e(),this},t.fn.setChecked=function(t,e,i){var n=this;return"boolean"==typeof t&&(e=t),"function"==typeof e&&(i=e),"string"==typeof t&&(n=n.findSelector(t)),null!=n&&(e?n.prop("checked","checked"):n.removeProp("checked")),"function"==typeof i&&i(),n},t.fn.isEmptyVal=function(){return null===this.val()||this.val().length<=0},t.fn.isSelector=function(t){return this.has(t).length>0},t.fn.isEnable=function(t){return"string"==typeof t?this.has(t+":enabled").length>0:this.is(":enabled")},t.fn.isChecked=function(t,e){var i=null;return i="string"==typeof t?this.has(t+":checked").length>0:this.is(":checked"),"boolean"==typeof t&&(e=t),"boolean"!=typeof e&&(e=!1),e?i?1:0:i},t.fn.isVisible=function(t){return"string"!=typeof t&&(t=this),"none"!==t.css("display")},t.fn.findSelector=function(t,e,i){var n=this.find(t,e,i);return n.length>0?n:null},t.fn.countSelector=function(t,e,i){return this.find(t,e,i).length},t.fn.setTextClass=function(e,i){var n=TEXT_CLASS_DANGER;return i="string"==typeof i?t(i):this,"string"!=typeof e&&(e=TEXT_CLASS_DANGER),i.removeClass(TEXT_CLASS_DANGER+" "+TEXT_CLASS_WARNING+" "+TEXT_CLASS_INFO+" "+TEXT_CLASS_SUCCESS),e==TEXT_CLASS_WARNING?n=TEXT_CLASS_WARNING:e==TEXT_CLASS_INFO?n=TEXT_CLASS_INFO:e==TEXT_CLASS_SUCCESS&&(n=TEXT_CLASS_SUCCESS),i.addClass(n)},t.fn.putCursorToEnd=function(){if(this.setSelectionRange){this.focus();var t=2*this.val().length;t>0&&this.setSelectionRange(t,t)}else this.val(this.val());return this.scrollTop&&(this.scrollTop=9999),this}}(jQuery);var ListFile={layout:null,list:null,action:null,alert:null,request:null,array:null,path:null,page:0,total:0,dialog:{},prefix:"action-list-file-",listSelector:["copy","chmod","archive","delete"],listAction:{icon:["clone","key","archive","trash"],label:["action_list_file_copy","action_list_file_chmod","action_list_file_archive","action_list_file_delete"]},ENTRY_DIALOG_COPY:0,ENTRY_DIALOG_CHMOD:1,ENTRY_DIALOG_ARCHIVE:2,ENTRY_DIALOG_DELETE:3,initializing:function(){this.layout=$("div#layout-list-file"),this.list=$("div#layout-list-file ul.list-file"),this.action=$("div#layout-list-file div.action-list-file"),this.alert=new Alert("div#layout-list-file div.alert"),this.path=SERVER.DOCUMENT_ROOT;for(var t=0;t<this.listSelector.length;++t)this.dialog[t]=new Dialog(this.prefix+this.listSelector[t],this.listAction.label[t],this.listAction,t),this.dialog[t].setId(t),this.dialog[t].setOnVisibleChangeListener(this.onVisibleChangeListener),this.dialog[t].setOnSubmitFormListener(this.onSubmitFormListener),this.dialog[t].setOnListActionListener(this.onListActionListener);this.invalidateLang(),this.setVisible(!1)},abort:function(){null!==this.request&&this.request.abort()},onVisibleChangeListener:function(t,e,i,n,a){i!==!1&&(e==ListFile.ENTRY_DIALOG_COPY?(a.path_to.val(ListFile.path),a.is_delete.setChecked(!1)):e==ListFile.ENTRY_DIALOG_CHMOD?(a.chmod_directory.val(CHOWN_DIRECTORY),a.chmod_file.val(CHOWN_FILE)):e==ListFile.ENTRY_DIALOG_ARCHIVE&&(a.path_save.val(ListFile.path),a.filename.val(ARCHIVE_NAME),a.is_override.setChecked(!0),a.is_delete.setChecked(!1)))},onSubmitFormListener:function(t,e,i,n){i.setEnable(!1,function(){Navigator.setProgress(!0)});var a=function(){i.setEnable(!0,function(){Navigator.setProgress(!1)})},o=new Array;ListFile.list.find("li[checked=checked] td span.name").each(function(){o.push($(this).text())}),t.id==ListFile.ENTRY_DIALOG_COPY?n.path_to.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_copy_to"),a):Func.validatePath(n.path_to.val())==ListFile.path?t.setAlert(Lang.receiver("path_new_right_other_path_old"),a):t.createRequest({url:CGI_PATH+CGI_ARRAY.ACTION_COPY,data:{path_to:n.path_to.val(),is_delete:n.is_delete.isChecked(!0),files:o},handler:{beforeSend:Lang.receiver("process_action_copy"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i):t.id==ListFile.ENTRY_DIALOG_CHMOD?n.chmod_directory.isEmptyVal()?t.setAlert(Lang.receiver("not_input_chmod_directory"),a):n.chmod_file.isEmptyVal()?t.setAlert(Lang.receiver("not_input_chmod_file"),a):0==Func.isChmodNumber(n.chmod_directory.val())?t.setAlert(Lang.receiver("chmod_directory_wrong"),a):0==Func.isChmodNumber(n.chmod_file.val())?t.setAlert(Lang.receiver("chmod_file_wrong"),a):t.createRequest({url:CGI_PATH+CGI_ARRAY.ACTION_CHMOD,data:{chmod_directory:n.chmod_directory.val(),chmod_file:n.chmod_file.val(),files:o},handler:{beforeSend:Lang.receiver("process_action_chmod"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i):t.id==ListFile.ENTRY_DIALOG_ARCHIVE?n.path_save.isEmptyVal()?t.setAlert(Lang.receiver("not_input_path_save_file_zip"),a):n.filename.isEmptyVal()?t.setAlert(Lang.receiver("not_input_filename_zip"),a):t.createRequest({url:CGI_PATH+CGI_ARRAY.ACTION_ARCHIVE,data:{path_save:n.path_save.val(),filename:n.filename.val(),is_override:n.is_override.isChecked(!0),is_delete:n.is_delete.isChecked(!0),files:o},handler:{beforeSend:Lang.receiver("process_action_archive"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i):t.id==ListFile.ENTRY_DIALOG_DELETE&&t.createRequest({url:CGI_PATH+CGI_ARRAY.ACTION_DELETE,data:{files:o},handler:{beforeSend:Lang.receiver("process_action_delete"),success:function(e){t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),ListFile.invalidate(e.path,e.list,ListFile.page,function(){setTimeout(function(){t.setVisible(!1)},TIME_EXIT_DIALOG)})}}},i)},onLocationPath:function(t){var e=t.attr("path");"string"==typeof e&&ListFile.receiver(e,null,!1,!0)},onBack:function(){if(ListFile.path!=SERVER.SP){var t=ListFile.path.lastIndexOf(SERVER.SP);t>0&&ListFile.receiver(ListFile.path.substring(0,t),null,!1,!0)}},onItem:function(t,e){var i=ListFile.getEntryByIndex(t);"boolean"!=typeof e&&(e=!0),null!=i&&(i.is_directory&&0==e?ListFile.receiver(ListFile.path+SERVER.SP+i.name,!1):i.is_directory&&e?DialogDirectory.setVisible(function(e){e.setData(t)},DialogDirectory.ENTRY_INFO):DialogFile.setVisible(function(e){e.setData(t)},DialogFile.ENTRY_INFO))},onPage:function(t){t<=ListFile.total&&(Navigator.setProgress(!0),setTimeout(function(){ListFile.invalidate(ListFile.path,ListFile.array,t),Navigator.setProgress(!1)},TIME_WAIT_GO_PAGE))},onActionListFile:function(t){var e=t.attr("name");"string"==typeof e&&("copy"==e?ListFile.setVisibleDialog(ListFile.ENTRY_DIALOG_COPY):"chmod"==e?ListFile.setVisibleDialog(ListFile.ENTRY_DIALOG_CHMOD):"archive"==e?ListFile.setVisibleDialog(ListFile.ENTRY_DIALOG_ARCHIVE):"delete"==e&&ListFile.setVisibleDialog(ListFile.ENTRY_DIALOG_DELETE))},onListActionListener:function(t,e){ListFile.setVisibleDialog(e,!0)},bind:function(t){var e=ListFile.layout.findSelector("div.location-path > ul > li > span"),i=ListFile.layout.findSelector("div.action-list-file button[type=button]"),n=ListFile.list.findSelector("li.back span.back"),a=ListFile.list.findSelector("li.back span#select-all"),o=ListFile.list.findSelector("li.directory td.name > span.click"),s=ListFile.list.findSelector("li.directory td.chmod > span.click"),l=ListFile.list.findSelector("li.file tr.first span.click"),r=ListFile.list.findSelector("li span#select"),u=ListFile.list.findSelector("li.paging ul.pagination li span.click");t?(null!=e&&e.bind(EVENT_CLICK,function(){ListFile.onLocationPath($(this))}),null!=n&&n.bind(EVENT_CLICK,function(){ListFile.onBack()}),null!=a&&a.bind(EVENT_CLICK,function(){var t=ListFile.list.countSelector("li.select"),e=ListFile.list.countSelector("li[checked=checked]");t>e?ListFile.list.find("li.select").attr("checked","checked"):ListFile.list.find("li.select").removeAttr("checked")}),null!=o&&o.bind(EVENT_CLICK,function(){ListFile.onItem(parseInt(this.id),!1)}),null!=s&&s.bind(EVENT_CLICK,function(){ListFile.onItem(parseInt(this.id))}),null!=l&&l.bind(EVENT_CLICK,function(){ListFile.onItem(parseInt(this.id))}),null!=r&&r.bind(EVENT_CLICK,function(){var t=$(this),e=ListFile.list.find("li[id="+parseInt(t.parent().attr("id"))+"]");"undefined"==typeof e.attr("checked")?e.attr("checked","checked"):e.removeAttr("checked");var i=ListFile.list.countSelector("li[checked=checked]");i>0?(ListFile.action.find("span#count").text(i),ListFile.action.animationIn(TIME_ANIMATION_IN)):ListFile.action.animationOut(TIME_ANIMATION_OUT)}),null!=u&&u.bind(EVENT_CLICK,function(){ListFile.onPage(parseInt(this.id))}),null!=i&&i.bind(EVENT_CLICK,function(){var t=ListFile.list.countSelector("li[checked=checked]");t>0?ListFile.onActionListFile($(this)):Toast.set(Lang.receiver("not_select_action_list_file"))})):(null!=e&&e.unbind(EVENT_CLICK),null!=n&&n.unbind(EVENT_CLICK),null!=a&&a.unbind(EVENT_CLICK),null!=o&&o.unbind(EVENT_CLICK),null!=s&&s.unbind(EVENT_CLICK),null!=l&&l.unbind(EVENT_CLICK),null!=r&&r.unbind(EVENT_CLICK),null!=u&&u.unbind(EVENT_CLICK),null!=i&&i.unbind(EVENT_CLICK))},getEntryByIndex:function(t){return"object"==typeof ListFile.array&&null!==ListFile.array&&ListFile.array.length>t?ListFile.array[t]:null},getEntryIndexByName:function(t,e){if("string"==typeof t&&(e=t,t=ListFile.array),"undefined"!=typeof t&&null!==t&&ListFile.array.length>0)for(var i=0;i<t.length;++i)if(t[i].name===e)return i;return 0},receiver:function(t,e,i,n){ListFile.abort(),"function"==typeof t&&(e=t),"string"!=typeof t&&(t=this.path),"boolean"==typeof e&&(i=e),"boolean"!=typeof i&&(i=!0),t=Func.validatePath(t),ListFile.alert.setVisible(!1),Navigator.setProgress(!0),ListFile.request=$.ajax({url:CGI_PATH+CGI_ARRAY.LIST_FILE,data:{dir:t,submit:!0},error:function(t,n,a){UError.processConnection(ListFile.isVisible()?ListFile.alert:null,t,n,function(){i&&Navigator.setProgress(!1),"function"==typeof e&&e(STATUS_ERROR)})},success:function(i,a,o){Data.validate(i)&&UError.processSuccess(ListFile.isVisible()?ListFile.alert:null,i,function(){Navigator.setProgress(!1),"function"==typeof e&&e(STATUS_ERROR)},function(){"string"==typeof i.path&&(t=i.path),0!=(i.code&RESULT_CODE_DIRECTORY_NOT_FOUND)&&ListFile.setAlert(Lang.receiver("path_not_exists")),ListFile.invalidate(t,i.list,n),Navigator.setProgress(!1),"function"==typeof e&&e(STATUS_SUCCESS)})}})},invalidate:function(t,e,i,n,a){if("string"==typeof t&&"object"==typeof e){t=Func.validatePath(t),"function"==typeof i&&(n=i),"boolean"==typeof i&&(a=i),"number"!=typeof i&&(i=1),"boolean"==typeof n&&(a=n),"boolean"!=typeof a&&(a=!1),null===e&&(e={});var o=ListFile.path,s=0,l=0,r=e.length,u=0,c=this.layout.find("div.location-path ul");if(a&&"string"==typeof o&&null!==o&&o!==t&&(o=Func.validatePath(o),o!==SERVER.SP)){var d=o.lastIndexOf(SERVER.SP);-1!==o&&(o=o.substring(d+1).replace(SERVER.SP,"")),s=ListFile.getEntryIndexByName(e,o)}if(CONFIGS.PAGING_LIST_FILE>0&&e.length>0&&(u=Math.ceil(e.length/CONFIGS.PAGING_LIST_FILE),a&&(i=s<=CONFIGS.PAGING_LIST_FILE?1:Math.ceil((s+1)/CONFIGS.PAGING_LIST_FILE)),i>u&&(i=u),l=i*CONFIGS.PAGING_LIST_FILE-CONFIGS.PAGING_LIST_FILE,r=l+CONFIGS.PAGING_LIST_FILE>=e.length?e.length:l+CONFIGS.PAGING_LIST_FILE),ListFile.path=t,ListFile.array=e,ListFile.page=i,ListFile.total=u,t!==SERVER.SP&&-1!==t.indexOf(SERVER.SP)){var f=t.replace(new RegExp("^"+SERVER.SP+"(.*?)$","g"),"$1"),p=new Array;-1!==f.indexOf(SERVER.SP)?p=f.split(SERVER.SP):p.push(f);for(var g="",_="",h=null,E=null,T=null,m=0;m<p.length;++m)E=p[m],0===m?(T=null!==t.match(new RegExp("^"+SERVER.SP+"(.*?)$","g"))?SERVER.SP:"",h=T+E):h=SERVER.SP+E,g+=m<p.length-1?"<li>"+SERVER.SP+'<span path="'+(_+h)+'">'+h.replace(SERVER.SP,"")+"</span></li>":"<li>"+SERVER.SP+'<span class="active">'+h.replace(SERVER.SP,"")+"</span></li>",_+=h;c.html(g)}else c.html('<li><span class="active">'+SERVER.SP+t+"</span></li>");var v=c.get(0).scrollWidth,I=c.parent().width();if(v>0&&v>I){var L=parseInt(c.css("margin").replace("px","")),A=I+L;c.scrollLeft(A)}else c.scrollLeft(0);if(e.length<=0){var N=null;t==SERVER.SP?N="":(N='<li class="directory back"><table><tr>',N+='<td class="icon"><span id="select-all" class="fa fa-folder fa-2x"></span></td>',N+='<td class="name"><span class="name back" lng="back_directory"></span></td>',N+="</tr></table></li>"),N+='<li class="directory empty"><table><tr>',N+='<td class="name"><span lng="empty_directory"></span></td>',N+="</tr></table></li>"}else{var N="";t!=SERVER.SP&&(N='<li class="directory back"><table><tr>',N+='<td class="icon"><span id="select-all" class="fa fa-folder fa-2x"></span></td>',N+='<td class="name"><span class="name back" lng="back_directory"></span></td>',N+="</tr></table></li>");for(var m=l;r>m;++m)e[m].is_directory?(N+='<li class="directory select" id="'+m+'"><table><tr>',N+='<td class="icon" id="'+m+'"><span class="fa fa-folder fa-2x" id="select"></span></td>',N+='<td class="name"><span id="'+m+'" class="name click">'+e[m].name+"</span></td>",N+='<td class="chmod"><span id="'+m+'" class="chmod click">'+e[m].chmod+"</span></td>",N+="</tr></table></li>"):(N+='<li class="file select" id="'+m+'"><table>',N+='<tr class="first"><td id="'+m+'">',N+='<span class="fa fa-file fa-2x icon" id="select"></span> <span id="'+m+'" class="name click">'+e[m].name+"</span>",N+="</td></tr>",N+='<tr class="last"><td>',N+='<span class="size">'+Func.parserSize(e[m].size)+'</span>, <span class="chmod">'+e[m].chmod+"</span>",N+="</td></tr>",N+="</table></li>")}ListFile.bind(!1),ListFile.list.html(ListFile.invalidatePage(N)),ListFile.action.animationOut(TIME_ANIMATION_OUT),ListFile.bind(!0)}ListFile.invalidateLang(),"function"==typeof n&&n()},invalidatePage:function(t){return ListFile.total>1&&(t+='<li class="paging">',t+='<ul class="pagination">'+Func.parserPage(ListFile.total,ListFile.page)+"</ul>",t+="</li>"),t},invalidateLang:function(){Lang.process(ListFile.layout)},setVisible:function(t,e){View.setVisible(this.layout,t,e)},isVisible:function(){return View.isVisible(this.layout)},setAlert:function(t,e,i,n){this.alert.set(t,e,i,n)},setVisibleDialog:function(t,e,i,n){"number"==typeof t&&(e=t),ListFile.dialog[e].setVisible(t,i,n)}},Login={layout:null,alert:null,initializing:function(){this.layout=$("div#container-login"),this.alert=new Alert("div#container-login div.alert"),this.layout.find("form").submit(function(){Login.onSubmit(Login)}),this.invalidateLang()},invalidateLang:function(){Lang.process(Login.layout)},onSubmit:function(t){var e=t.layout.find("input[type=submit]"),i=t.layout.find("input[name=username]"),n=t.layout.find("input[name=password]"),a=function(){e.setEnable(!0,function(){Navigator.setProgress(!1)})};e.setEnable(!1,function(){Navigator.setProgress(!0)}),i.isEmptyVal()?t.setAlert(Lang.receiver("not_input_username"),a):n.isEmptyVal()?t.setAlert(Lang.receiver("not_input_password"),a):$.ajax({url:CGI_PATH+CGI_ARRAY.LOGIN,data:{username:i.val(),password:n.val(),submit:e.val()},beforeSend:function(){t.setAlert('<span class="progress-text">'+Lang.receiver("process_login")+"</span>",ALERT_INFO)},error:function(e,i,n){UError.processConnection(t.alert,e,i,a)},success:function(e,i,n){Data.validate(e,a,!1)&&UError.processSuccess(t.alert,e,a,function(){0!=(e.code&RESULT_CODE_IS_STATUS_LOGIN)?t.setAlert(Lang.parse(e.success),ALERT_INFO):t.setAlert(Lang.parse(e.success),ALERT_SUCCESS),setTimeout(function(){Initializing.initializing()},500)})}})},isVisible:function(){return View.isVisible(Login.layout)},setVisible:function(t,e){Login.layout.find("input[type=submit]").setEnable(!0),Login.alert.setVisible(!1),View.setVisible(this.layout,t,e)},setAlert:function(t,e,i){Login.alert.set(t,e,i)}},Navigator={layout:null,home:null,progress:null,initializing:function(){this.layout=$("div#navigator"),this.home=this.layout.find("div#navigator-action-option span#home"),this.progress=this.layout.find("div.progressbar-navigator"),this.bind(!0),this.setLogin(!1),this.setProgress(!1)},bind:function(t){var e=Navigator.layout.findSelector("div#navigator-action-option span"),i=Navigator.layout.findSelector("div#navigator-action-file span");t?(null!=e&&e.bind(EVENT_CLICK,function(){Navigator.onActionOption(this)}),null!=i&&i.bind(EVENT_CLICK,function(){Navigator.onActionFile(this)})):(null!=e&&e.unbind(EVENT_CLICK),null!=i&&i.unbind(EVENT_CLICK))},onActionOption:function(t){var e=-1;"setting"===t.id?e=DialogNavigator.ENTRY_SETTING:"info"===t.id?e=DialogNavigator.ENTRY_INFO:"exit"===t.id&&(e=DialogNavigator.ENTRY_EXIT),-1!=e&&DialogNavigator.setVisible(e)},onActionFile:function(t){var e=-1;"create"===t.id?e=DialogNavigator.ENTRY_FILE_CREATE:"upload"===t.id?e=DialogNavigator.ENTRY_FILE_UPLOAD:"import"===t.id&&(e=DialogNavigator.ENTRY_FILE_IMPORT),-1!=e&&DialogNavigator.setVisible(e)},setLogin:function(t){$(".is-login").each(function(){var e=$(this),i=e.css("display");t?"none"===i&&e.animationIn(TIME_ANIMATION_IN):"none"!==i&&e.animationOut(TIME_ANIMATION_OUT)})},setProgress:function(t,e){var i=Navigator.progress.css("display");t&&Navigator.home.css("color","transparent"),t&&"none"===i?Navigator.progress.animationIn(TIME_ANIMATION_IN,e):0==t&&"none"!==i?Navigator.progress.animationOut(TIME_ANIMATION_OUT,function(){Navigator.home.css("color","inherit"),"function"==typeof e&&e()}):"function"==typeof e&&e()}},Toast={layout:null,response:null,time:null,out:null,initializing:function(){this.layout=$("div#navigator-toast"),this.response=this.layout.find("span#response"),this.time=TIME_HIDE_TOAST},set:function(t,e,i){this.setResponse(t),this.setVisible(!0,e,i)},setResponse:function(t){this.response.html(t)},setVisible:function(t,e,i){"undefined"!=typeof this.out&&null!==this.out&&t&&clearTimeout(this.out),"function"==typeof e&&(i=e),"number"!=typeof e&&(e=this.time),t?this.layout.animationIn(TIME_ANIMATION_IN,function(){this.out=setTimeout(function(){Toast.setVisible(!1,e,i)},Toast.time),"function"==typeof i&&i()}):this.layout.animationOut(TIME_ANIMATION_OUT,i)}},UError={layout:null,response:null,initializing:function(){this.layout=$("div#layout-error"),this.response=this.layout.find("span#response"),this.setVisible(!1)},setVisible:function(t,e){View.setVisible(this.layout,t,e)},setResponse:function(t){this.response.text(t)},setError:function(t,e){Content.hideAllEntry(function(){UError.setResponse(t),UError.setVisible(!0),"function"==typeof e&&e()})},processConnection:function(t,e,i,n,a,o,s){var l=Lang.receiver("error_connection");return"boolean"==typeof o&&(s=o),"boolean"!=typeof s&&(s=!1),"timeout"===i?l=Lang.receiver("error_connection_timeout"):"parsererror"===i?l=Lang.receiver("error_connection_parser")+"<br/><br/> "+e.responseText:"error"===i?404==e.status?l=Lang.receiver("error_connection_status_404"):500==e.status?l=Lang.receiver("error_connection_status_500"):503==e.status&&(l=Lang.receiver("error_connection_status_503")):"abort"===i&&(l=s?Lang.receiver("error_connection_abort"):null),null===l?void("function"==typeof n&&n()):void("function"==typeof t?setTimeout(function(){t(o,l,n)},TIME_ERROR_CONNECTION):"undefined"==typeof t||null===t?this.setError(l,n):setTimeout(function(){t.set(l,n,a)},TIME_ERROR_CONNECTION))},processSuccess:function(t,e,i,n,a,o){null!=e.error?"function"==typeof t?t(o,Lang.parse(e.error),function(){"function"==typeof i&&i()}):"undefined"!=typeof t&&null!==t?t.set(Lang.parse(e.error),function(){"function"==typeof i&&i()},a):this.setError(Lang.parse(e.error),i):"function"==typeof n&&n()}},View={isVisible:function(t){return"undefined"==typeof t||null===t?!1:"none"!==t.css("display")},setVisible:function(t,e,i){if("undefined"==typeof t||null===t)return!1;var n=t.css("display");e&&"none"===n?t.animationIn(TIME_ANIMATION_IN,function(){$("#footer").animationIn(0),"function"==typeof i&&i()}):0==e&&"none"!==n?t.animationOut(TIME_ANIMATION_OUT,function(){$("#footer").animationOut(0),"function"==typeof i&&i()}):"function"==typeof i&&(e?$("#footer").animationIn(0):$("#footer").animationOut(0),i())}};$(document).ready(function(){$.ajaxSetup({method:CGI_METHOD,dataType:CGI_DATA_TYPE}),$("form").each(function(){var t=$(this);t.attr("action","#"),t.attr("method","post"),t.attr("onsubmit","return false")});for(var t=[Navigator,Toast,Login,Content,UError,Initializing,ListFile,DialogDirectory,DialogFile,DialogNavigator],e=0;e<t.length;++e)t[e].initializing()});